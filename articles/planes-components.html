<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="rplanes">
<title>PLANES Components • rplanes</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="PLANES Components">
<meta property="og:description" content="rplanes">
<meta property="og:image" content="https://signaturescience.github.io/rplanes/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">rplanes</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/basic-usage.html">Basic Usage</a>
    <a class="dropdown-item" href="../articles/planes-components.html">PLANES Components</a>
    <a class="dropdown-item" href="../articles/rplanes-explorer.html">rplanes Explorer</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>PLANES Components</h1>
            
      
      
      <div class="d-none name"><code>planes-components.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>The <code>rplanes</code> package currently has a set of seven
components that each perform plausibility analysis of epidemiological
signals (PLANES). Each of the individual components assesses different
characteristics of the evaluated signal, resolving to a binary indicator
(i.e., <code>TRUE</code> or <code>FALSE</code> as to whether or not the
signal is <em>implausible</em>). All components are wrapped via the
<code><a href="../reference/plane_score.html">plane_score()</a></code> function to generate an overall score based
on the number of components for which a flag is raised.</p>
<p>Here we provide a narrative walk through of each of the individual
PLANES components. The full list of components, along with the
corresponding functions and parameters (if applicable), is provided in
the table below. It is important to emphasize that <code>rplanes</code>
is designed to work for both <em>forecasted</em> and <em>observed</em>
epidemiological signals. However, not all of the components will work on
both types of signals. Several components (including coverage, taper,
trend, and shape) can only be used to assess plausibility of
forecasts.</p>
<table class="table">
<colgroup>
<col width="6%">
<col width="37%">
<col width="8%">
<col width="5%">
<col width="5%">
<col width="36%">
</colgroup>
<thead><tr class="header">
<th align="left">Component</th>
<th align="left">Description</th>
<th align="left">Function</th>
<th align="left">Forecast</th>
<th align="left">Observed</th>
<th align="left">Parameters</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Difference</td>
<td align="left">Point-to-point difference</td>
<td align="left">plane_diff()</td>
<td align="left">YES</td>
<td align="left">YES</td>
<td align="left">None</td>
</tr>
<tr class="even">
<td align="left">Coverage</td>
<td align="left">Prediction interval covers the most recent
observation</td>
<td align="left">plane_cover()</td>
<td align="left">YES</td>
<td align="left">NO</td>
<td align="left">None</td>
</tr>
<tr class="odd">
<td align="left">Taper</td>
<td align="left">Prediction interval narrows as horizon increases</td>
<td align="left">plane_taper()</td>
<td align="left">YES</td>
<td align="left">NO</td>
<td align="left">None</td>
</tr>
<tr class="even">
<td align="left">Repeat</td>
<td align="left">Values repeat more than expected</td>
<td align="left">plane_repeat()</td>
<td align="left">YES</td>
<td align="left">YES</td>
<td align="left">Tolerated number of repeats; Number of observations to
prepend</td>
</tr>
<tr class="odd">
<td align="left">Trend</td>
<td align="left">Signal exhibits change in trend compared to recent
observations</td>
<td align="left">plane_trend()</td>
<td align="left">YES</td>
<td align="left">NO</td>
<td align="left">Significance level for trend change</td>
</tr>
<tr class="even">
<td align="left">Shape</td>
<td align="left">Shape of signal trajectory has not been observed in
seed data</td>
<td align="left">plane_shape()</td>
<td align="left">YES</td>
<td align="left">NO</td>
<td align="left">None</td>
</tr>
<tr class="odd">
<td align="left">Zero</td>
<td align="left">Zeros found in signal when not in seed</td>
<td align="left">plane_zero()</td>
<td align="left">YES</td>
<td align="left">YES</td>
<td align="left">None</td>
</tr>
</tbody>
</table>
<p>All components are designed to take a location (i.e., string
specifying location code), the signal prepared with
<code><a href="../reference/to_signal.html">to_signal()</a></code> that will be evaluated, and the seed prepared
with <code><a href="../reference/plane_seed.html">plane_seed()</a></code> that holds baseline characteristics. To
further customize behavior, some of the functions accept additional
arguments, each of which is detailed in the examples that follow. Each
component function returns a <code>list</code> that is standardized to
at minimum return an “indicator” element, which returns
<code>TRUE</code> if the component flag is raised (i.e., data is
implausible) and <code>FALSE</code> if the component flag is not raised
(i.e., data is not implausible).</p>
<p>It is important to emphasize that all of the individual components
are wrapped in the <code><a href="../reference/plane_score.html">plane_score()</a></code> function for ease-of-use,
and in practice most users will likely use the wrapper instead of
accessing the functions directly. However, in the examples below we use
the functions outside of <code><a href="../reference/plane_score.html">plane_score()</a></code> to more clearly
demonstrate how they operate. Likewise, we have created mock forecast
data in each of the examples to demonstrate usage. Users should refer to
the <a href="basic-usage.html">“Basic Usage” vignette</a> for practical
guidance on how to prepare data for <code>rplanes</code> analyses.</p>
</div>
<div class="section level2">
<h2 id="data-preparation">Data preparation<a class="anchor" aria-label="anchor" href="#data-preparation"></a>
</h2>
<p>As mentioned above, the data evaluated in the examples that follow
will be mock forecasts. We will compare these forecasted values to the
<a href="https://healthdata.gov/Hospital/COVID-19-Reported-Patient-Impact-and-Hospital-Capa/g62h-syeh" class="external-link">HHS
Protect incident flu hospitalization data</a> that has been aggregated
from daily to weekly resolution, and is provided as internal
<code>rplanes</code> package data. For more details on the data
preparation for <code>rplanes</code> see the <a href="basic-usage.html">“Basic Usage” vignette</a>.</p>
<p>The code below will load the required packages, prepare the observed
data as a signal with <code><a href="../reference/to_signal.html">to_signal()</a></code>, and convert the observed
signal to a seed with <code><a href="../reference/plane_seed.html">plane_seed()</a></code>. Note that for the
examples below we use a cut date of “2022-06-04” for the seed data:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## load packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://signaturescience.github.io/rplanes/">rplanes</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">## read in observed data</span></span>
<span><span class="va">hosp_all</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/observed/hdgov_hosp_weekly.csv"</span>, package <span class="op">=</span> <span class="st">"rplanes"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">location</span>, <span class="va">flu.admits</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## prepare observed signal</span></span>
<span><span class="va">observed_signal</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/to_signal.html">to_signal</a></span><span class="op">(</span>input <span class="op">=</span> <span class="va">hosp_all</span>, outcome <span class="op">=</span> <span class="st">"flu.admits"</span>, type <span class="op">=</span> <span class="st">"observed"</span>, resolution <span class="op">=</span> <span class="st">"weeks"</span>, horizon <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## create seed with cut date</span></span>
<span><span class="va">prepped_seed</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plane_seed.html">plane_seed</a></span><span class="op">(</span><span class="va">observed_signal</span>, cut_date <span class="op">=</span> <span class="st">"2022-06-04"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="difference---plane_diff">Difference - <code>plane_diff()</code><a class="anchor" aria-label="anchor" href="#difference---plane_diff"></a>
</h2>
<p>The difference component checks the point-to-point differences for
evaluated signal. This component can be used on either forecasts or
observed signals. The function internally computes the maximum observed
difference (using absolute value) and checks to see if any of the
point-to-point differences for the evaluated data exceed that threshold.
If so, the flag is raised.</p>
<div class="section level3">
<h3 id="flagged-as-implausible">Flagged as implausible<a class="anchor" aria-label="anchor" href="#flagged-as-implausible"></a>
</h3>
<p>The example below uses a forecasted signal in which the 1 week-ahead
forecast dramatically jumps from the most recent observed data:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">point_est</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">120</span>, <span class="fl">140</span>, <span class="fl">160</span><span class="op">)</span></span>
<span></span>
<span><span class="va">prepped_forecast</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    location <span class="op">=</span> <span class="st">"01"</span>,</span>
<span>    date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2022-06-11"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2022-07-02"</span><span class="op">)</span>, by <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>,</span>
<span>    horizon <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,</span>
<span>    lower <span class="op">=</span> <span class="va">point_est</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">30</span>, <span class="fl">40</span><span class="op">)</span>,</span>
<span>    <span class="co">## make a large jump in hospitalizations to trigger diff component</span></span>
<span>    point <span class="op">=</span> <span class="va">point_est</span>,</span>
<span>    upper <span class="op">=</span> <span class="va">point_est</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">30</span>, <span class="fl">40</span><span class="op">)</span>,</span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/to_signal.html">to_signal</a></span><span class="op">(</span>outcome <span class="op">=</span> <span class="st">"flu.admits"</span>, type <span class="op">=</span> <span class="st">"forecast"</span>, horizon <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prepped_forecast</span><span class="op">$</span><span class="va">data</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">location</th>
<th align="left">date</th>
<th align="right">horizon</th>
<th align="right">lower</th>
<th align="right">point</th>
<th align="right">upper</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">01</td>
<td align="left">2022-06-11</td>
<td align="right">1</td>
<td align="right">90</td>
<td align="right">100</td>
<td align="right">110</td>
</tr>
<tr class="even">
<td align="left">01</td>
<td align="left">2022-06-18</td>
<td align="right">2</td>
<td align="right">100</td>
<td align="right">120</td>
<td align="right">140</td>
</tr>
<tr class="odd">
<td align="left">01</td>
<td align="left">2022-06-25</td>
<td align="right">3</td>
<td align="right">110</td>
<td align="right">140</td>
<td align="right">170</td>
</tr>
<tr class="even">
<td align="left">01</td>
<td align="left">2022-07-02</td>
<td align="right">4</td>
<td align="right">120</td>
<td align="right">160</td>
<td align="right">200</td>
</tr>
</tbody>
</table>
<p>The seed stores the last observed value and the maximum difference
for the given location:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prepped_seed</span><span class="op">$</span><span class="va">`01`</span><span class="op">$</span><span class="va">last_value</span></span>
<span><span class="co">#&gt; [1] 19</span></span>
<span></span>
<span><span class="va">prepped_seed</span><span class="op">$</span><span class="va">`01`</span><span class="op">$</span><span class="va">diff</span><span class="op">$</span><span class="va">max</span></span>
<span><span class="co">#&gt; [1] 21</span></span></code></pre></div>
<p>We would expect the implausibility flag to be raised in this
case:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plane_diff.html">plane_diff</a></span><span class="op">(</span>location <span class="op">=</span> <span class="st">"01"</span>, input <span class="op">=</span> <span class="va">prepped_forecast</span>, seed <span class="op">=</span> <span class="va">prepped_seed</span><span class="op">)</span></span>
<span><span class="co">#&gt; $indicator</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $values</span></span>
<span><span class="co">#&gt; [1]  19 100 120 140 160</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $evaluated_differences</span></span>
<span><span class="co">#&gt; [1] 81 20 20 20</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $maximum_difference</span></span>
<span><span class="co">#&gt; [1] 21</span></span></code></pre></div>
<p>We can visualize the point-to-point differences and see where the
data jumps with the forecast:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">diff_dat</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">prepped_forecast</span><span class="op">$</span><span class="va">data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"forecast"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>flu.admits <span class="op">=</span> <span class="va">point</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">observed_signal</span><span class="op">$</span><span class="va">data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">location</span> <span class="op">==</span> <span class="st">"01"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">date</span> <span class="op">&lt;=</span> <span class="st">"2022-06-04"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">"observed"</span><span class="op">)</span>, <span class="va">.</span> <span class="op">)</span></span>
<span></span>
<span><span class="va">diff_flags</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">diff_dat</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"forecast"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">date</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">diff_dat</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">flu.admits</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>lty <span class="op">=</span> <span class="st">"dotted"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">diff_flags</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">flu.admits</span><span class="op">)</span>, shape<span class="op">=</span><span class="fl">23</span>, size<span class="op">=</span><span class="fl">4</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">lower</span>, ymax <span class="op">=</span> <span class="va">upper</span>, fill <span class="op">=</span> <span class="va">type</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Date"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Flu hospitalizations"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Difference component\nFlagged"</span><span class="op">)</span></span></code></pre></div>
<p><img src="planes-components_files/figure-html/unnamed-chunk-9-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="not-flagged-as-implausible">Not flagged as implausible<a class="anchor" aria-label="anchor" href="#not-flagged-as-implausible"></a>
</h3>
<p>The next example will include data that does not “jump” in absolute
difference beyond what has been observed in the time series
previously:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">point_est</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">28</span>, <span class="fl">31</span>, <span class="fl">34</span>, <span class="fl">37</span><span class="op">)</span></span>
<span></span>
<span><span class="va">prepped_forecast</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    location <span class="op">=</span> <span class="st">"01"</span>,</span>
<span>    date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2022-06-11"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2022-07-02"</span><span class="op">)</span>, by <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>,</span>
<span>    horizon <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,</span>
<span>    lower <span class="op">=</span> <span class="va">point_est</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">20</span><span class="op">)</span>,</span>
<span>    point <span class="op">=</span> <span class="va">point_est</span>,</span>
<span>    upper <span class="op">=</span> <span class="va">point_est</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">20</span><span class="op">)</span>,</span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/to_signal.html">to_signal</a></span><span class="op">(</span>outcome <span class="op">=</span> <span class="st">"flu.admits"</span>, type <span class="op">=</span> <span class="st">"forecast"</span>, horizon <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prepped_forecast</span><span class="op">$</span><span class="va">data</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">location</th>
<th align="left">date</th>
<th align="right">horizon</th>
<th align="right">lower</th>
<th align="right">point</th>
<th align="right">upper</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">01</td>
<td align="left">2022-06-11</td>
<td align="right">1</td>
<td align="right">23</td>
<td align="right">28</td>
<td align="right">33</td>
</tr>
<tr class="even">
<td align="left">01</td>
<td align="left">2022-06-18</td>
<td align="right">2</td>
<td align="right">21</td>
<td align="right">31</td>
<td align="right">41</td>
</tr>
<tr class="odd">
<td align="left">01</td>
<td align="left">2022-06-25</td>
<td align="right">3</td>
<td align="right">19</td>
<td align="right">34</td>
<td align="right">49</td>
</tr>
<tr class="even">
<td align="left">01</td>
<td align="left">2022-07-02</td>
<td align="right">4</td>
<td align="right">17</td>
<td align="right">37</td>
<td align="right">57</td>
</tr>
</tbody>
</table>
<p>Again, we can see the last value and maximum observed difference for
the given location that will be used internally in the seed:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prepped_seed</span><span class="op">$</span><span class="va">`01`</span><span class="op">$</span><span class="va">last_value</span></span>
<span><span class="co">#&gt; [1] 19</span></span>
<span></span>
<span><span class="va">prepped_seed</span><span class="op">$</span><span class="va">`01`</span><span class="op">$</span><span class="va">diff</span><span class="op">$</span><span class="va">max</span></span>
<span><span class="co">#&gt; [1] 21</span></span></code></pre></div>
<p>Given this max difference, we would not expect the implausibility
flag to be raised in this case:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plane_diff.html">plane_diff</a></span><span class="op">(</span>location <span class="op">=</span> <span class="st">"01"</span>, input <span class="op">=</span> <span class="va">prepped_forecast</span>, seed <span class="op">=</span> <span class="va">prepped_seed</span><span class="op">)</span></span>
<span><span class="co">#&gt; $indicator</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $values</span></span>
<span><span class="co">#&gt; [1] 19 28 31 34 37</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $evaluated_differences</span></span>
<span><span class="co">#&gt; [1] 9 3 3 3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $maximum_difference</span></span>
<span><span class="co">#&gt; [1] 21</span></span></code></pre></div>
<p>The plot below shows the forecasted data that would not raise the
difference flag:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">diff_dat</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">prepped_forecast</span><span class="op">$</span><span class="va">data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"forecast"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>flu.admits <span class="op">=</span> <span class="va">point</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">observed_signal</span><span class="op">$</span><span class="va">data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">location</span> <span class="op">==</span> <span class="st">"01"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">date</span> <span class="op">&lt;=</span> <span class="st">"2022-06-04"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">"observed"</span><span class="op">)</span>, <span class="va">.</span> <span class="op">)</span></span>
<span></span>
<span><span class="va">diff_dat</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">flu.admits</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>lty <span class="op">=</span> <span class="st">"dotted"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">lower</span>, ymax <span class="op">=</span> <span class="va">upper</span>, fill <span class="op">=</span> <span class="va">type</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Date"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Flu hospitalizations"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Difference component\nNot flagged"</span><span class="op">)</span></span></code></pre></div>
<p><img src="planes-components_files/figure-html/unnamed-chunk-15-1.png" width="672"></p>
</div>
</div>
<div class="section level2">
<h2 id="coverage---plane_cover">Coverage - <code>plane_cover()</code><a class="anchor" aria-label="anchor" href="#coverage---plane_cover"></a>
</h2>
<p>The coverage component compares the prediction interval for the first
horizon of the evaluated signal to the most recent value in the seed. If
the interval does not cover the most recent data point, then the flag is
raised as implausible. Because this component requires a prediction
interval, it can only be used to assess plausibility of forecast
signals.</p>
<div class="section level3">
<h3 id="flagged-as-implausible-1">Flagged as implausible<a class="anchor" aria-label="anchor" href="#flagged-as-implausible-1"></a>
</h3>
<p>We can create forecast data that includes a prediction interval that
does not cover the most recent value in seed:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## make sure the 1 week-ahead point estimate and PI do not cover the last reported obs</span></span>
<span><span class="va">point_est</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">60</span>, <span class="fl">62</span>, <span class="fl">64</span>, <span class="fl">66</span><span class="op">)</span></span>
<span></span>
<span><span class="va">prepped_forecast</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    location <span class="op">=</span> <span class="st">"01"</span>,</span>
<span>    date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2022-06-11"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2022-07-02"</span><span class="op">)</span>, by <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>,</span>
<span>    horizon <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,</span>
<span>    lower <span class="op">=</span> <span class="va">point_est</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">6</span>, <span class="fl">8</span><span class="op">)</span>,</span>
<span>    point <span class="op">=</span> <span class="va">point_est</span>,</span>
<span>    upper <span class="op">=</span> <span class="va">point_est</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">6</span>, <span class="fl">8</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/to_signal.html">to_signal</a></span><span class="op">(</span>outcome <span class="op">=</span> <span class="st">"flu.admits"</span>, type <span class="op">=</span> <span class="st">"forecast"</span>, horizon <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prepped_forecast</span><span class="op">$</span><span class="va">data</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">location</th>
<th align="left">date</th>
<th align="right">horizon</th>
<th align="right">lower</th>
<th align="right">point</th>
<th align="right">upper</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">01</td>
<td align="left">2022-06-11</td>
<td align="right">1</td>
<td align="right">58</td>
<td align="right">60</td>
<td align="right">62</td>
</tr>
<tr class="even">
<td align="left">01</td>
<td align="left">2022-06-18</td>
<td align="right">2</td>
<td align="right">58</td>
<td align="right">62</td>
<td align="right">66</td>
</tr>
<tr class="odd">
<td align="left">01</td>
<td align="left">2022-06-25</td>
<td align="right">3</td>
<td align="right">58</td>
<td align="right">64</td>
<td align="right">70</td>
</tr>
<tr class="even">
<td align="left">01</td>
<td align="left">2022-07-02</td>
<td align="right">4</td>
<td align="right">58</td>
<td align="right">66</td>
<td align="right">74</td>
</tr>
</tbody>
</table>
<p>The prediction interval is quite narrow and departs from the last
observed value in the seed:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prepped_seed</span><span class="op">$</span><span class="va">`01`</span><span class="op">$</span><span class="va">last_value</span></span>
<span><span class="co">#&gt; [1] 19</span></span></code></pre></div>
<p>We would expect the coverage flag to be raised:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plane_cover.html">plane_cover</a></span><span class="op">(</span>location <span class="op">=</span> <span class="st">"01"</span>, input <span class="op">=</span> <span class="va">prepped_forecast</span>, seed <span class="op">=</span> <span class="va">prepped_seed</span><span class="op">)</span></span>
<span><span class="co">#&gt; $indicator</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $last_value</span></span>
<span><span class="co">#&gt; [1] 19</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $bounds</span></span>
<span><span class="co">#&gt; $bounds$lower</span></span>
<span><span class="co">#&gt; [1] 58</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $bounds$upper</span></span>
<span><span class="co">#&gt; [1] 62</span></span></code></pre></div>
<p>The plot below shows the coverage of the forecast prediction
intervals in relation to the seed data:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cover_dat</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">prepped_forecast</span><span class="op">$</span><span class="va">data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"forecast"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>flu.admits <span class="op">=</span> <span class="va">point</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">observed_signal</span><span class="op">$</span><span class="va">data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">location</span> <span class="op">==</span> <span class="st">"01"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">date</span> <span class="op">&lt;=</span> <span class="st">"2022-06-04"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">"observed"</span><span class="op">)</span>, <span class="va">.</span> <span class="op">)</span></span>
<span></span>
<span><span class="va">cov_flags</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">cover_dat</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"observed"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">date</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">cover_dat</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">flu.admits</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>lty<span class="op">=</span><span class="st">"dotted"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">cov_flags</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">flu.admits</span><span class="op">)</span>, shape<span class="op">=</span><span class="fl">23</span>, size<span class="op">=</span><span class="fl">4</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">lower</span>, ymax <span class="op">=</span> <span class="va">upper</span>, fill <span class="op">=</span> <span class="va">type</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Date"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Flu hospitalizations"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Coverage component\nFlagged"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="planes-components_files/figure-html/unnamed-chunk-21-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="not-flagged-as-implausible-1">Not flagged as implausible<a class="anchor" aria-label="anchor" href="#not-flagged-as-implausible-1"></a>
</h3>
<p>We can put together an example where the prediction interval for the
first horizon covers the most recent value in the seed data:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## make sure the 1 week-ahead point estimate and PI cover the last reported obs</span></span>
<span><span class="va">point_est</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">28</span>, <span class="fl">31</span>, <span class="fl">34</span>, <span class="fl">37</span><span class="op">)</span></span>
<span></span>
<span><span class="va">prepped_forecast</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    location <span class="op">=</span> <span class="st">"01"</span>,</span>
<span>    date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2022-06-11"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2022-07-02"</span><span class="op">)</span>, by <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>,</span>
<span>    horizon <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,</span>
<span>    lower <span class="op">=</span> <span class="va">point_est</span> <span class="op">-</span> <span class="fl">28</span>,</span>
<span>    point <span class="op">=</span> <span class="va">point_est</span>,</span>
<span>    upper <span class="op">=</span> <span class="va">point_est</span> <span class="op">+</span> <span class="fl">28</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/to_signal.html">to_signal</a></span><span class="op">(</span>outcome <span class="op">=</span> <span class="st">"flu.admits"</span>, type <span class="op">=</span> <span class="st">"forecast"</span>, horizon <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prepped_forecast</span><span class="op">$</span><span class="va">data</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">location</th>
<th align="left">date</th>
<th align="right">horizon</th>
<th align="right">lower</th>
<th align="right">point</th>
<th align="right">upper</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">01</td>
<td align="left">2022-06-11</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">28</td>
<td align="right">56</td>
</tr>
<tr class="even">
<td align="left">01</td>
<td align="left">2022-06-18</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">31</td>
<td align="right">59</td>
</tr>
<tr class="odd">
<td align="left">01</td>
<td align="left">2022-06-25</td>
<td align="right">3</td>
<td align="right">6</td>
<td align="right">34</td>
<td align="right">62</td>
</tr>
<tr class="even">
<td align="left">01</td>
<td align="left">2022-07-02</td>
<td align="right">4</td>
<td align="right">9</td>
<td align="right">37</td>
<td align="right">65</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prepped_seed</span><span class="op">$</span><span class="va">`01`</span><span class="op">$</span><span class="va">last_value</span></span>
<span><span class="co">#&gt; [1] 19</span></span></code></pre></div>
<p>Given the coverage, we would not expect the signal to be flagged as
implausible:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plane_cover.html">plane_cover</a></span><span class="op">(</span>location <span class="op">=</span> <span class="st">"01"</span>, input <span class="op">=</span> <span class="va">prepped_forecast</span>, seed <span class="op">=</span> <span class="va">prepped_seed</span><span class="op">)</span></span>
<span><span class="co">#&gt; $indicator</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $last_value</span></span>
<span><span class="co">#&gt; [1] 19</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $bounds</span></span>
<span><span class="co">#&gt; $bounds$lower</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $bounds$upper</span></span>
<span><span class="co">#&gt; [1] 56</span></span></code></pre></div>
<p>Again, we can visualize the coverage of the forecast relative to the
seed data:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cover_dat</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">prepped_forecast</span><span class="op">$</span><span class="va">data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"forecast"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>flu.admits <span class="op">=</span> <span class="va">point</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">observed_signal</span><span class="op">$</span><span class="va">data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">location</span> <span class="op">==</span> <span class="st">"01"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">date</span> <span class="op">&lt;=</span> <span class="st">"2022-06-04"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">"observed"</span><span class="op">)</span>, <span class="va">.</span> <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">cover_dat</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">flu.admits</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>lty<span class="op">=</span><span class="st">"dotted"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">lower</span>, ymax <span class="op">=</span> <span class="va">upper</span>, fill <span class="op">=</span> <span class="va">type</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Date"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Flu hospitalizations"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Coverage component\nNot flagged"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="planes-components_files/figure-html/unnamed-chunk-27-1.png" width="672"></p>
</div>
</div>
<div class="section level2">
<h2 id="taper---plane_taper">Taper - <code>plane_taper()</code><a class="anchor" aria-label="anchor" href="#taper---plane_taper"></a>
</h2>
<p>The taper component checks whether or not the prediction interval for
the evaluated signal decreases in width (i.e., certainty increases) as
horizons progress. Because this component requires a prediction
interval, it can only be used to assess plausibility of forecast
signals.</p>
<div class="section level3">
<h3 id="flagged-as-implausible-2">Flagged as implausible<a class="anchor" aria-label="anchor" href="#flagged-as-implausible-2"></a>
</h3>
<p>Here we create a mock forecast that will have a narrowing prediction
interval:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">point_est</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">33</span>, <span class="fl">36</span>, <span class="fl">39</span><span class="op">)</span></span>
<span></span>
<span><span class="va">prepped_forecast</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    location <span class="op">=</span> <span class="st">"01"</span>,</span>
<span>    date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2022-06-11"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2022-07-02"</span><span class="op">)</span>, by <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>,</span>
<span>    horizon <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,</span>
<span>    <span class="co">## make the lower and upper bounds get narrower as horizon increases</span></span>
<span>    lower <span class="op">=</span> <span class="va">point_est</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">15</span>, <span class="fl">10</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>    point <span class="op">=</span> <span class="va">point_est</span>,</span>
<span>    upper <span class="op">=</span> <span class="va">point_est</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">15</span>, <span class="fl">10</span>, <span class="fl">5</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/to_signal.html">to_signal</a></span><span class="op">(</span>outcome <span class="op">=</span> <span class="st">"flu.admits"</span>, type <span class="op">=</span> <span class="st">"forecast"</span>, horizon <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prepped_forecast</span><span class="op">$</span><span class="va">data</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">location</th>
<th align="left">date</th>
<th align="right">horizon</th>
<th align="right">lower</th>
<th align="right">point</th>
<th align="right">upper</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">01</td>
<td align="left">2022-06-11</td>
<td align="right">1</td>
<td align="right">10</td>
<td align="right">30</td>
<td align="right">50</td>
</tr>
<tr class="even">
<td align="left">01</td>
<td align="left">2022-06-18</td>
<td align="right">2</td>
<td align="right">18</td>
<td align="right">33</td>
<td align="right">48</td>
</tr>
<tr class="odd">
<td align="left">01</td>
<td align="left">2022-06-25</td>
<td align="right">3</td>
<td align="right">26</td>
<td align="right">36</td>
<td align="right">46</td>
</tr>
<tr class="even">
<td align="left">01</td>
<td align="left">2022-07-02</td>
<td align="right">4</td>
<td align="right">34</td>
<td align="right">39</td>
<td align="right">44</td>
</tr>
</tbody>
</table>
<p>The width of the prediction interval narrows from 40 to 30 to 20 to
10 over the forecasted horizons. We would expect the taper flag to be
raised:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plane_taper.html">plane_taper</a></span><span class="op">(</span>location <span class="op">=</span> <span class="st">"01"</span>, input <span class="op">=</span> <span class="va">prepped_forecast</span>, seed <span class="op">=</span> <span class="va">prepped_seed</span><span class="op">)</span></span>
<span><span class="co">#&gt; $indicator</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $widths</span></span>
<span><span class="co">#&gt; [1] 40 30 20 10</span></span></code></pre></div>
<p>The plot below visually demonstrates the tapering effect:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">taper_dat</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">prepped_forecast</span><span class="op">$</span><span class="va">data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"forecast"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>flu.admits <span class="op">=</span> <span class="va">point</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">observed_signal</span><span class="op">$</span><span class="va">data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">location</span> <span class="op">==</span> <span class="st">"01"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">date</span> <span class="op">&lt;=</span> <span class="st">"2022-06-04"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">"observed"</span><span class="op">)</span>, <span class="va">.</span> <span class="op">)</span></span>
<span></span>
<span><span class="va">taper_flags</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">taper_dat</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"forecast"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">taper_dat</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">taper_dat</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">flu.admits</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>lty<span class="op">=</span><span class="st">"dotted"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">taper_flags</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">flu.admits</span><span class="op">)</span>, shape<span class="op">=</span><span class="fl">23</span>, size<span class="op">=</span><span class="fl">4</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">lower</span>, ymax <span class="op">=</span> <span class="va">upper</span>, fill <span class="op">=</span> <span class="va">type</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Date"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Flu Hospital Admissions"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Taper component\nFlagged"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="planes-components_files/figure-html/unnamed-chunk-32-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="not-flagged-as-implausible-2">Not flagged as implausible<a class="anchor" aria-label="anchor" href="#not-flagged-as-implausible-2"></a>
</h3>
<p>Now we can look at an example where the forecasted prediction
interval increases in width as horizons progress:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">point_est</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">33</span>, <span class="fl">36</span>, <span class="fl">39</span><span class="op">)</span></span>
<span></span>
<span><span class="va">prepped_forecast</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    location <span class="op">=</span> <span class="st">"01"</span>,</span>
<span>    date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2022-06-11"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2022-07-02"</span><span class="op">)</span>, by <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>,</span>
<span>    horizon <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,</span>
<span>    <span class="co">## make the lower and upper bounds get wider as horizon increases</span></span>
<span>    lower <span class="op">=</span> <span class="va">point_est</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">20</span><span class="op">)</span>,</span>
<span>    point <span class="op">=</span> <span class="va">point_est</span>,</span>
<span>    upper <span class="op">=</span> <span class="va">point_est</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">20</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/to_signal.html">to_signal</a></span><span class="op">(</span>outcome <span class="op">=</span> <span class="st">"flu.admits"</span>, type <span class="op">=</span> <span class="st">"forecast"</span>, horizon <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prepped_forecast</span><span class="op">$</span><span class="va">data</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">location</th>
<th align="left">date</th>
<th align="right">horizon</th>
<th align="right">lower</th>
<th align="right">point</th>
<th align="right">upper</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">01</td>
<td align="left">2022-06-11</td>
<td align="right">1</td>
<td align="right">25</td>
<td align="right">30</td>
<td align="right">35</td>
</tr>
<tr class="even">
<td align="left">01</td>
<td align="left">2022-06-18</td>
<td align="right">2</td>
<td align="right">23</td>
<td align="right">33</td>
<td align="right">43</td>
</tr>
<tr class="odd">
<td align="left">01</td>
<td align="left">2022-06-25</td>
<td align="right">3</td>
<td align="right">21</td>
<td align="right">36</td>
<td align="right">51</td>
</tr>
<tr class="even">
<td align="left">01</td>
<td align="left">2022-07-02</td>
<td align="right">4</td>
<td align="right">19</td>
<td align="right">39</td>
<td align="right">59</td>
</tr>
</tbody>
</table>
<p>We would not expect the implausibility flag to be raised in this
case:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plane_taper.html">plane_taper</a></span><span class="op">(</span>location <span class="op">=</span> <span class="st">"01"</span>, input <span class="op">=</span> <span class="va">prepped_forecast</span>, seed <span class="op">=</span> <span class="va">prepped_seed</span><span class="op">)</span></span>
<span><span class="co">#&gt; $indicator</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $widths</span></span>
<span><span class="co">#&gt; [1] 10 20 30 40</span></span></code></pre></div>
<p>In the visualization below we see that the forecast prediction
interval does not taper:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">taper_dat</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">prepped_forecast</span><span class="op">$</span><span class="va">data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"forecast"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>flu.admits <span class="op">=</span> <span class="va">point</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">observed_signal</span><span class="op">$</span><span class="va">data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">location</span> <span class="op">==</span> <span class="st">"01"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">date</span> <span class="op">&lt;=</span> <span class="st">"2022-06-04"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">"observed"</span><span class="op">)</span>, <span class="va">.</span> <span class="op">)</span></span>
<span></span>
<span><span class="va">taper_dat</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">taper_dat</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">flu.admits</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>lty<span class="op">=</span><span class="st">"dotted"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">lower</span>, ymax <span class="op">=</span> <span class="va">upper</span>, fill <span class="op">=</span> <span class="va">type</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Date"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Flu Hospital Admissions"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Taper component\nNot flagged"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="planes-components_files/figure-html/unnamed-chunk-37-1.png" width="672"></p>
</div>
</div>
<div class="section level2">
<h2 id="repeat---plane_repeat">Repeat - <code>plane_repeat()</code><a class="anchor" aria-label="anchor" href="#repeat---plane_repeat"></a>
</h2>
<p>The repeat component checks whether consecutive values in an observed
or forecasted signal are repeated <em>k</em> times. When the seed is
created, it stores the maximum number of consecutive repeats for each
location and uses this as the default value for <em>k</em>. If the
evaluated data exceeds <em>k</em> then the signal is considered
implausible and a flag is raised.</p>
<p>The <em>k</em> threshold for repeats can be customized using the
“tolerance” parameter. The function also allows users to customize the
“prepend” length (i.e., the number of most recent values from seed to be
concatenated with the evaluated signal while checking for repeats).</p>
<p>To illustrate the repeat parameters, we can contrive a simple
example. Consider seed values of <code>11, 12, 13, 13, 13</code> and an
evaluated forecast with point estimates <code>13, 13, 15, 16</code>. If
the tolerance threshold is set at <code>4</code> and prepend length is
<code>2</code> then the sequence <code>13, 13, 13, 13, 15, 16</code>
would be checked for any set of more than four values repeated
consecutively. In that case, no flag would be raised. The value
<code>13</code> is repeated four times but we <em>tolerate</em> at most
four repeats. However, if we keep the tolerance at <code>4</code> and
change the prepend length to <code>3</code>, the evaluated sequence
would be <code>13, 13, 13, 13, 13, 15, 16</code>, and a flag would be
raised, because there were more repeats than the tolerance
threshold.</p>
<p>For more on these parameters see <code>?plane_repeat()</code>.</p>
<div class="section level3">
<h3 id="flagged-as-implausible-3">Flagged as implausible<a class="anchor" aria-label="anchor" href="#flagged-as-implausible-3"></a>
</h3>
<p>We can mock up some example data that repeats the same point
estimate:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## make sure the point estimates repeat</span></span>
<span><span class="va">point_est</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">55</span>, <span class="fl">55</span>, <span class="fl">55</span>, <span class="fl">55</span><span class="op">)</span></span>
<span></span>
<span><span class="va">prepped_forecast</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    location <span class="op">=</span> <span class="st">"01"</span>,</span>
<span>    date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2022-06-11"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2022-07-02"</span><span class="op">)</span>, by <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>,</span>
<span>    horizon <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,</span>
<span>    lower <span class="op">=</span> <span class="va">point_est</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">20</span><span class="op">)</span>,</span>
<span>    point <span class="op">=</span> <span class="va">point_est</span>,</span>
<span>    upper <span class="op">=</span> <span class="va">point_est</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">20</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/to_signal.html">to_signal</a></span><span class="op">(</span>outcome <span class="op">=</span> <span class="st">"flu.admits"</span>, type <span class="op">=</span> <span class="st">"forecast"</span>, horizon <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prepped_forecast</span><span class="op">$</span><span class="va">data</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">location</th>
<th align="left">date</th>
<th align="right">horizon</th>
<th align="right">lower</th>
<th align="right">point</th>
<th align="right">upper</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">01</td>
<td align="left">2022-06-11</td>
<td align="right">1</td>
<td align="right">50</td>
<td align="right">55</td>
<td align="right">60</td>
</tr>
<tr class="even">
<td align="left">01</td>
<td align="left">2022-06-18</td>
<td align="right">2</td>
<td align="right">45</td>
<td align="right">55</td>
<td align="right">65</td>
</tr>
<tr class="odd">
<td align="left">01</td>
<td align="left">2022-06-25</td>
<td align="right">3</td>
<td align="right">40</td>
<td align="right">55</td>
<td align="right">70</td>
</tr>
<tr class="even">
<td align="left">01</td>
<td align="left">2022-07-02</td>
<td align="right">4</td>
<td align="right">35</td>
<td align="right">55</td>
<td align="right">75</td>
</tr>
</tbody>
</table>
<p>We can check the maximum number of repeats that have been seen in the
seed data:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prepped_seed</span><span class="op">$</span><span class="va">`01`</span><span class="op">$</span><span class="va">max_repeats</span></span>
<span><span class="co">#&gt; [1] 2</span></span></code></pre></div>
<p>Because the number of repeated point estimates we have defined above
exceeds the maximum repeats we expect a flag to be raised:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plane_repeat.html">plane_repeat</a></span><span class="op">(</span>location <span class="op">=</span> <span class="st">"01"</span>, input <span class="op">=</span> <span class="va">prepped_forecast</span>, seed <span class="op">=</span> <span class="va">prepped_seed</span>, tolerance <span class="op">=</span> <span class="cn">NULL</span>, prepend <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="co">#&gt; $indicator</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $repeats</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 6</span></span></span>
<span><span class="co">#&gt;   point location date       horizon lower upper</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>    55 01       2022-06-11       1    50    60</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>    55 01       2022-06-18       2    45    65</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>    55 01       2022-06-25       3    40    70</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>    55 01       2022-07-02       4    35    75</span></span></code></pre></div>
<p>We can visualize the repeats in the forecast data:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">repeat_dat</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">prepped_forecast</span><span class="op">$</span><span class="va">data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"forecast"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>flu.admits <span class="op">=</span> <span class="va">point</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">observed_signal</span><span class="op">$</span><span class="va">data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">location</span> <span class="op">==</span> <span class="st">"01"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">date</span> <span class="op">&lt;=</span> <span class="st">"2022-06-04"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">"observed"</span><span class="op">)</span>, <span class="va">.</span> <span class="op">)</span></span>
<span></span>
<span><span class="va">repeat_flags</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">repeat_dat</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"forecast"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">repeat_dat</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">repeat_dat</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">flu.admits</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>lty<span class="op">=</span><span class="st">"dotted"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">repeat_flags</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">flu.admits</span><span class="op">)</span>, shape<span class="op">=</span><span class="fl">23</span>, size<span class="op">=</span><span class="fl">4</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">lower</span>, ymax <span class="op">=</span> <span class="va">upper</span>,fill <span class="op">=</span> <span class="va">type</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Date"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Flu hospitalizations"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Repeat component\nFlagged"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="planes-components_files/figure-html/unnamed-chunk-43-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="controlling-sensitivity-with-parameters">Controlling sensitivity with parameters<a class="anchor" aria-label="anchor" href="#controlling-sensitivity-with-parameters"></a>
</h3>
<p>As described above, the “tolerance” parameter allows the user to
override the default behavior that sets the maximum number of repeats
via the seed. Setting a higher tolerance will decrease the sensitivity
of the repeat assessment. In this example, if we increase the tolerance
to <code>4</code> then we would not expect the flag to be raised:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plane_repeat.html">plane_repeat</a></span><span class="op">(</span>location <span class="op">=</span> <span class="st">"01"</span>, input <span class="op">=</span> <span class="va">prepped_forecast</span>, seed <span class="op">=</span> <span class="va">prepped_seed</span>, tolerance <span class="op">=</span> <span class="fl">4</span>, prepend <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="co">#&gt; $indicator</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $repeats</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 0 × 6</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 6 variables: point &lt;dbl&gt;, location &lt;chr&gt;, date &lt;date&gt;, horizon &lt;int&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   lower &lt;dbl&gt;, upper &lt;dbl&gt;</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="not-flagged-as-implausible-3">Not flagged as implausible<a class="anchor" aria-label="anchor" href="#not-flagged-as-implausible-3"></a>
</h3>
<p>Here we prepare mock forecast data that does not have repeating point
estimates:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## make sure the point estimates do not repeat</span></span>
<span><span class="va">point_est</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">55</span>, <span class="fl">57</span>, <span class="fl">59</span>, <span class="fl">61</span><span class="op">)</span></span>
<span></span>
<span><span class="va">prepped_forecast</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    location <span class="op">=</span> <span class="st">"01"</span>,</span>
<span>    date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2022-06-11"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2022-07-02"</span><span class="op">)</span>, by <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>,</span>
<span>    horizon <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,</span>
<span>    lower <span class="op">=</span> <span class="va">point_est</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">20</span><span class="op">)</span>,</span>
<span>    point <span class="op">=</span> <span class="va">point_est</span>,</span>
<span>    upper <span class="op">=</span> <span class="va">point_est</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">20</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="../reference/to_signal.html">to_signal</a></span><span class="op">(</span>outcome <span class="op">=</span> <span class="st">"flu.admits"</span>, type <span class="op">=</span> <span class="st">"forecast"</span>, horizon <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prepped_forecast</span><span class="op">$</span><span class="va">data</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">location</th>
<th align="left">date</th>
<th align="right">horizon</th>
<th align="right">lower</th>
<th align="right">point</th>
<th align="right">upper</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">01</td>
<td align="left">2022-06-11</td>
<td align="right">1</td>
<td align="right">50</td>
<td align="right">55</td>
<td align="right">60</td>
</tr>
<tr class="even">
<td align="left">01</td>
<td align="left">2022-06-18</td>
<td align="right">2</td>
<td align="right">47</td>
<td align="right">57</td>
<td align="right">67</td>
</tr>
<tr class="odd">
<td align="left">01</td>
<td align="left">2022-06-25</td>
<td align="right">3</td>
<td align="right">44</td>
<td align="right">59</td>
<td align="right">74</td>
</tr>
<tr class="even">
<td align="left">01</td>
<td align="left">2022-07-02</td>
<td align="right">4</td>
<td align="right">41</td>
<td align="right">61</td>
<td align="right">81</td>
</tr>
</tbody>
</table>
<p>We can see the maximum number of repeats in the seed:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prepped_seed</span><span class="op">$</span><span class="va">`01`</span><span class="op">$</span><span class="va">max_repeats</span></span>
<span><span class="co">#&gt; [1] 2</span></span></code></pre></div>
<p>Based on this threshold, we would not expect the implausibility flag
for repeats to be raised:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plane_repeat.html">plane_repeat</a></span><span class="op">(</span>location <span class="op">=</span> <span class="st">"01"</span>, input <span class="op">=</span> <span class="va">prepped_forecast</span>, seed <span class="op">=</span> <span class="va">prepped_seed</span>, tolerance <span class="op">=</span> <span class="cn">NULL</span>, prepend <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="co">#&gt; $indicator</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $repeats</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 0 × 6</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 6 variables: point &lt;dbl&gt;, location &lt;chr&gt;, date &lt;date&gt;, horizon &lt;int&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   lower &lt;dbl&gt;, upper &lt;dbl&gt;</span></span></span></code></pre></div>
<p>Lastly, we can visualize the repeats for the signal:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">repeat_dat</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">prepped_forecast</span><span class="op">$</span><span class="va">data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"forecast"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>flu.admits <span class="op">=</span> <span class="va">point</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">observed_signal</span><span class="op">$</span><span class="va">data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">location</span> <span class="op">==</span> <span class="st">"01"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">date</span> <span class="op">&lt;=</span> <span class="st">"2022-06-04"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">"observed"</span><span class="op">)</span>, <span class="va">.</span> <span class="op">)</span></span>
<span></span>
<span><span class="va">repeat_dat</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">repeat_dat</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">flu.admits</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>lty<span class="op">=</span><span class="st">"dotted"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">lower</span>, ymax <span class="op">=</span> <span class="va">upper</span>, fill <span class="op">=</span> <span class="va">type</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Date"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Flu hospitalizations"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Repeat component\nNot flagged"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="planes-components_files/figure-html/unnamed-chunk-50-1.png" width="672"></p>
</div>
</div>
<div class="section level2">
<h2 id="trend---plane_trend">Trend - <code>plane_trend()</code><a class="anchor" aria-label="anchor" href="#trend---plane_trend"></a>
</h2>
<p>The trend component assesses whether or not there is a significant
change in the magnitude or direction of the slope for the evaluated
signal compared to the most recent data in the seed. If a “change point”
is identified in any of the forecasted horizons and/or the most recent
seed value, then the flag is raised for implausibility. The trend
component requires at least four times as many seed values as there are
evaluated values. Furthermore, the component currently can only be used
with forecasted signals.</p>
<p>One of the parameters for the trend function is “sig_lvl”, which
defines the significance level for the internal permutation test used to
detect change points. By default this value is set to <code>0.1</code>.
The significance level determines the sensitivity of the trend
plausibility assessment, with a lower value corresponding to a less
sensitive evaluation.</p>
<p>For more on the trend algorithm methods see
<code>?plane_trend()</code>.</p>
<div class="section level3">
<h3 id="flagged-as-implausible-4">Flagged as implausible<a class="anchor" aria-label="anchor" href="#flagged-as-implausible-4"></a>
</h3>
<p>Here we create some example data that doubles with each forecasted
horizon:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">point_est</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">50</span>, <span class="fl">100</span>, <span class="fl">200</span><span class="op">)</span></span>
<span></span>
<span><span class="va">prepped_forecast</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    location <span class="op">=</span> <span class="st">"01"</span>,</span>
<span>    date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2022-06-11"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2022-07-02"</span><span class="op">)</span>, by <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>,</span>
<span>    horizon <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,</span>
<span>    lower <span class="op">=</span> <span class="va">point_est</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">40</span><span class="op">)</span>,</span>
<span>    point <span class="op">=</span> <span class="va">point_est</span>,</span>
<span>    upper <span class="op">=</span> <span class="va">point_est</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">40</span><span class="op">)</span>,</span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/to_signal.html">to_signal</a></span><span class="op">(</span>outcome <span class="op">=</span> <span class="st">"flu.admits"</span>, type <span class="op">=</span> <span class="st">"forecast"</span>, horizon <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prepped_forecast</span><span class="op">$</span><span class="va">data</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">location</th>
<th align="left">date</th>
<th align="right">horizon</th>
<th align="right">lower</th>
<th align="right">point</th>
<th align="right">upper</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">01</td>
<td align="left">2022-06-11</td>
<td align="right">1</td>
<td align="right">20</td>
<td align="right">25</td>
<td align="right">30</td>
</tr>
<tr class="even">
<td align="left">01</td>
<td align="left">2022-06-18</td>
<td align="right">2</td>
<td align="right">40</td>
<td align="right">50</td>
<td align="right">60</td>
</tr>
<tr class="odd">
<td align="left">01</td>
<td align="left">2022-06-25</td>
<td align="right">3</td>
<td align="right">80</td>
<td align="right">100</td>
<td align="right">120</td>
</tr>
<tr class="even">
<td align="left">01</td>
<td align="left">2022-07-02</td>
<td align="right">4</td>
<td align="right">160</td>
<td align="right">200</td>
<td align="right">240</td>
</tr>
</tbody>
</table>
<p>We expect the dramatic increase in slope will be detected as a change
point and a flag raised:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plane_trend.html">plane_trend</a></span><span class="op">(</span>location <span class="op">=</span> <span class="st">"01"</span>, input <span class="op">=</span> <span class="va">prepped_forecast</span>, seed <span class="op">=</span> <span class="va">prepped_seed</span>, sig_lvl <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="co">#&gt; $indicator</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $output</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 20 × 7</span></span></span>
<span><span class="co">#&gt;    Location Index Date       Value Type     Changepoint Flagged</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 01           1 2022-02-19    20 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 01           2 2022-02-26    14 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 01           3 2022-03-05    35 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 01           4 2022-03-12    30 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 01           5 2022-03-19    30 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 01           6 2022-03-26    25 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 01           7 2022-04-02    32 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 01           8 2022-04-09    29 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 01           9 2022-04-16    19 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 01          10 2022-04-23    30 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> 01          11 2022-04-30    13 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> 01          12 2022-05-07    25 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> 01          13 2022-05-14    15 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> 01          14 2022-05-21    12 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span> 01          15 2022-05-28    22 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span> 01          16 2022-06-04    19 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">17</span> 01          17 2022-06-11    25 Forecast FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">18</span> 01          18 2022-06-18    50 Forecast TRUE        TRUE   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">19</span> 01          19 2022-06-25   100 Forecast FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">20</span> 01          20 2022-07-02   200 Forecast FALSE       FALSE  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $flagged_dates</span></span>
<span><span class="co">#&gt; [1] "2022-06-18"</span></span></code></pre></div>
<p>The plot below shows the forecasted value identified as a change
point:</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trend_dat</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">prepped_forecast</span><span class="op">$</span><span class="va">data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"forecast"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>flu.admits <span class="op">=</span> <span class="va">point</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">observed_signal</span><span class="op">$</span><span class="va">data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">location</span> <span class="op">==</span> <span class="st">"01"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">date</span> <span class="op">&lt;=</span> <span class="st">"2022-06-04"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">"observed"</span><span class="op">)</span>, <span class="va">.</span> <span class="op">)</span></span>
<span></span>
<span><span class="va">trend_flags</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/plane_trend.html">plane_trend</a></span><span class="op">(</span>location <span class="op">=</span> <span class="st">"01"</span>, input <span class="op">=</span> <span class="va">prepped_forecast</span>, seed <span class="op">=</span> <span class="va">prepped_seed</span>, sig_lvl <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">$</span><span class="va">output</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Changepoint</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">trend_dat</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">flu.admits</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>lty<span class="op">=</span><span class="st">"dotted"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">lower</span>, ymax <span class="op">=</span> <span class="va">upper</span>, fill <span class="op">=</span> <span class="va">type</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">trend_flags</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Date</span>, y <span class="op">=</span> <span class="va">Value</span><span class="op">)</span>, shape<span class="op">=</span><span class="fl">23</span>, size<span class="op">=</span><span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Date"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Flu hospitalizations"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Trend component\nFlagged"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="planes-components_files/figure-html/unnamed-chunk-55-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="controlling-sensitivity-with-parameters-1">Controlling sensitivity with parameters<a class="anchor" aria-label="anchor" href="#controlling-sensitivity-with-parameters-1"></a>
</h3>
<p>By toggling the significance level, we can control the sensitivity of
the trend assessment. Here we lower the significance level to
<code>0.001</code> and see that the flag is no longer raised using the
same data as above:</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plane_trend.html">plane_trend</a></span><span class="op">(</span>location <span class="op">=</span> <span class="st">"01"</span>, input <span class="op">=</span> <span class="va">prepped_forecast</span>, seed <span class="op">=</span> <span class="va">prepped_seed</span>, sig_lvl <span class="op">=</span> <span class="fl">0.001</span><span class="op">)</span></span>
<span><span class="co">#&gt; $indicator</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $output</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 20 × 7</span></span></span>
<span><span class="co">#&gt;    Location Index Date       Value Type     Changepoint Flagged</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 01           1 2022-02-19    20 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 01           2 2022-02-26    14 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 01           3 2022-03-05    35 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 01           4 2022-03-12    30 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 01           5 2022-03-19    30 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 01           6 2022-03-26    25 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 01           7 2022-04-02    32 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 01           8 2022-04-09    29 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 01           9 2022-04-16    19 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 01          10 2022-04-23    30 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> 01          11 2022-04-30    13 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> 01          12 2022-05-07    25 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> 01          13 2022-05-14    15 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> 01          14 2022-05-21    12 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span> 01          15 2022-05-28    22 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span> 01          16 2022-06-04    19 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">17</span> 01          17 2022-06-11    25 Forecast FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">18</span> 01          18 2022-06-18    50 Forecast FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">19</span> 01          19 2022-06-25   100 Forecast FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">20</span> 01          20 2022-07-02   200 Forecast FALSE       FALSE  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $flagged_dates</span></span>
<span><span class="co">#&gt; [1] NA</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="not-flagged-as-implausible-4">Not flagged as implausible<a class="anchor" aria-label="anchor" href="#not-flagged-as-implausible-4"></a>
</h3>
<p>We can also make example data that reflects a consistent trend with
the seed:</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">point_est</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">40</span>, <span class="fl">41</span>, <span class="fl">40</span>, <span class="fl">43</span><span class="op">)</span></span>
<span></span>
<span><span class="va">prepped_forecast</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    location <span class="op">=</span> <span class="st">"01"</span>,</span>
<span>    date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2022-06-11"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2022-07-02"</span><span class="op">)</span>, by <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>,</span>
<span>    horizon <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,</span>
<span>    lower <span class="op">=</span> <span class="va">point_est</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">20</span><span class="op">)</span>,</span>
<span>    point <span class="op">=</span> <span class="va">point_est</span>,</span>
<span>    upper <span class="op">=</span> <span class="va">point_est</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">20</span><span class="op">)</span>,</span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/to_signal.html">to_signal</a></span><span class="op">(</span>outcome <span class="op">=</span> <span class="st">"flu.admits"</span>, type <span class="op">=</span> <span class="st">"forecast"</span>, horizon <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prepped_forecast</span><span class="op">$</span><span class="va">data</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">location</th>
<th align="left">date</th>
<th align="right">horizon</th>
<th align="right">lower</th>
<th align="right">point</th>
<th align="right">upper</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">01</td>
<td align="left">2022-06-11</td>
<td align="right">1</td>
<td align="right">35</td>
<td align="right">40</td>
<td align="right">45</td>
</tr>
<tr class="even">
<td align="left">01</td>
<td align="left">2022-06-18</td>
<td align="right">2</td>
<td align="right">31</td>
<td align="right">41</td>
<td align="right">51</td>
</tr>
<tr class="odd">
<td align="left">01</td>
<td align="left">2022-06-25</td>
<td align="right">3</td>
<td align="right">25</td>
<td align="right">40</td>
<td align="right">55</td>
</tr>
<tr class="even">
<td align="left">01</td>
<td align="left">2022-07-02</td>
<td align="right">4</td>
<td align="right">23</td>
<td align="right">43</td>
<td align="right">63</td>
</tr>
</tbody>
</table>
<p>In this case we would not expect an implausibility flag to be
raised:</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plane_trend.html">plane_trend</a></span><span class="op">(</span>location <span class="op">=</span> <span class="st">"01"</span>, input <span class="op">=</span> <span class="va">prepped_forecast</span>, seed <span class="op">=</span> <span class="va">prepped_seed</span>, sig_lvl <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="co">#&gt; $indicator</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $output</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 20 × 7</span></span></span>
<span><span class="co">#&gt;    Location Index Date       Value Type     Changepoint Flagged</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 01           1 2022-02-19    20 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 01           2 2022-02-26    14 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 01           3 2022-03-05    35 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 01           4 2022-03-12    30 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 01           5 2022-03-19    30 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 01           6 2022-03-26    25 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 01           7 2022-04-02    32 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 01           8 2022-04-09    29 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 01           9 2022-04-16    19 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 01          10 2022-04-23    30 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> 01          11 2022-04-30    13 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> 01          12 2022-05-07    25 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> 01          13 2022-05-14    15 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> 01          14 2022-05-21    12 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span> 01          15 2022-05-28    22 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span> 01          16 2022-06-04    19 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">17</span> 01          17 2022-06-11    40 Forecast FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">18</span> 01          18 2022-06-18    41 Forecast FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">19</span> 01          19 2022-06-25    40 Forecast FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">20</span> 01          20 2022-07-02    43 Forecast FALSE       FALSE  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $flagged_dates</span></span>
<span><span class="co">#&gt; [1] NA</span></span></code></pre></div>
<p>The visualization below shows the consistency of the forecasted trend
with the comparison data in the seed:</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trend_dat</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">prepped_forecast</span><span class="op">$</span><span class="va">data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"forecast"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>flu.admits <span class="op">=</span> <span class="va">point</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">observed_signal</span><span class="op">$</span><span class="va">data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">location</span> <span class="op">==</span> <span class="st">"01"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">date</span> <span class="op">&lt;=</span> <span class="st">"2022-06-04"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">"observed"</span><span class="op">)</span>, <span class="va">.</span> <span class="op">)</span></span>
<span></span>
<span><span class="va">trend_flags</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/plane_trend.html">plane_trend</a></span><span class="op">(</span>location <span class="op">=</span> <span class="st">"01"</span>, input <span class="op">=</span> <span class="va">prepped_forecast</span>, seed <span class="op">=</span> <span class="va">prepped_seed</span>, sig_lvl <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">$</span><span class="va">output</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Changepoint</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">trend_dat</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">flu.admits</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>lty<span class="op">=</span><span class="st">"dotted"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">lower</span>, ymax <span class="op">=</span> <span class="va">upper</span>, fill <span class="op">=</span> <span class="va">type</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">trend_flags</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Date</span>, y <span class="op">=</span> <span class="va">Value</span><span class="op">)</span>, shape<span class="op">=</span><span class="fl">23</span>, size<span class="op">=</span><span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Date"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Flu hospitalizations"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Trend component\nNot flagged"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="planes-components_files/figure-html/unnamed-chunk-61-1.png" width="672"></p>
<p>Note that there are some cases where <code><a href="../reference/plane_trend.html">plane_trend()</a></code> will
identify a change point in the seed data but will not raise an
implausibility flag for the forecast. The trend component checks for
change points in all forecasted horizons and the most recent value in
the seed. If there is a significant change point found elsewhere in the
seed time series, the function will not raise a flag. However, the
output includes any change points detected regardless of whether or not
they raised on an implausibility flag.</p>
<p>To demonstrate this, we can look at location “06”. For this example,
we need to define a new <code>prepped_seed</code> object because this
change point occurs after our previously defined cut date:</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## create seed with cut date</span></span>
<span><span class="va">prepped_seed2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plane_seed.html">plane_seed</a></span><span class="op">(</span><span class="va">observed_signal</span>, cut_date <span class="op">=</span> <span class="st">"2022-10-29"</span><span class="op">)</span></span>
<span><span class="va">point_est</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">40</span>, <span class="fl">41</span>, <span class="fl">40</span>, <span class="fl">43</span><span class="op">)</span></span>
<span></span>
<span><span class="va">prepped_forecast</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    location <span class="op">=</span> <span class="st">"06"</span>,</span>
<span>    date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2022-11-05"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2022-11-26"</span><span class="op">)</span>, by <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>,</span>
<span>    horizon <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,</span>
<span>    lower <span class="op">=</span> <span class="va">point_est</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">20</span><span class="op">)</span>,</span>
<span>    point <span class="op">=</span> <span class="va">point_est</span>,</span>
<span>    upper <span class="op">=</span> <span class="va">point_est</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">20</span><span class="op">)</span>,</span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/to_signal.html">to_signal</a></span><span class="op">(</span>outcome <span class="op">=</span> <span class="st">"flu.admits"</span>, type <span class="op">=</span> <span class="st">"forecast"</span>, horizon <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prepped_forecast</span><span class="op">$</span><span class="va">data</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">location</th>
<th align="left">date</th>
<th align="right">horizon</th>
<th align="right">lower</th>
<th align="right">point</th>
<th align="right">upper</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">06</td>
<td align="left">2022-11-05</td>
<td align="right">1</td>
<td align="right">35</td>
<td align="right">40</td>
<td align="right">45</td>
</tr>
<tr class="even">
<td align="left">06</td>
<td align="left">2022-11-12</td>
<td align="right">2</td>
<td align="right">31</td>
<td align="right">41</td>
<td align="right">51</td>
</tr>
<tr class="odd">
<td align="left">06</td>
<td align="left">2022-11-19</td>
<td align="right">3</td>
<td align="right">25</td>
<td align="right">40</td>
<td align="right">55</td>
</tr>
<tr class="even">
<td align="left">06</td>
<td align="left">2022-11-26</td>
<td align="right">4</td>
<td align="right">23</td>
<td align="right">43</td>
<td align="right">63</td>
</tr>
</tbody>
</table>
<p>In this case we would not expect an implausibility flag to be raised,
but we do see a change point:</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plane_trend.html">plane_trend</a></span><span class="op">(</span>location <span class="op">=</span> <span class="st">"06"</span>, input <span class="op">=</span> <span class="va">prepped_forecast</span>, seed <span class="op">=</span> <span class="va">prepped_seed2</span>, sig_lvl <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="co">#&gt; $indicator</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $output</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 20 × 7</span></span></span>
<span><span class="co">#&gt;    Location Index Date       Value Type     Changepoint Flagged</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 06           1 2022-07-16   102 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 06           2 2022-07-23    64 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 06           3 2022-07-30    46 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 06           4 2022-08-06    39 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 06           5 2022-08-13    38 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 06           6 2022-08-20    39 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 06           7 2022-08-27    33 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 06           8 2022-09-03    35 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 06           9 2022-09-10    29 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 06          10 2022-09-17    24 Observed TRUE        FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> 06          11 2022-09-24    35 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> 06          12 2022-10-01    72 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> 06          13 2022-10-08    93 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> 06          14 2022-10-15    97 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span> 06          15 2022-10-22   124 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span> 06          16 2022-10-29   211 Observed FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">17</span> 06          17 2022-11-05    40 Forecast FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">18</span> 06          18 2022-11-12    41 Forecast FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">19</span> 06          19 2022-11-19    40 Forecast FALSE       FALSE  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">20</span> 06          20 2022-11-26    43 Forecast FALSE       FALSE  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $flagged_dates</span></span>
<span><span class="co">#&gt; [1] NA</span></span></code></pre></div>
<p>Note that on 2022-09-17, a change point was detected, but because it
was not in our forecast, nor was it the last observed data point there
was no flag raised.</p>
<p>The visualization below shows the change point in the observed
data:</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trend_dat</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">prepped_forecast</span><span class="op">$</span><span class="va">data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"forecast"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>flu.admits <span class="op">=</span> <span class="va">point</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">observed_signal</span><span class="op">$</span><span class="va">data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">location</span> <span class="op">==</span> <span class="st">"06"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">date</span> <span class="op">&lt;=</span> <span class="st">"2022-10-29"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">"observed"</span><span class="op">)</span>, <span class="va">.</span> <span class="op">)</span></span>
<span></span>
<span><span class="va">trend_flags</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/plane_trend.html">plane_trend</a></span><span class="op">(</span>location <span class="op">=</span> <span class="st">"06"</span>, input <span class="op">=</span> <span class="va">prepped_forecast</span>, seed <span class="op">=</span> <span class="va">prepped_seed2</span>, sig_lvl <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">$</span><span class="va">output</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Changepoint</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">trend_dat</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">flu.admits</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>lty<span class="op">=</span><span class="st">"dotted"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">lower</span>, ymax <span class="op">=</span> <span class="va">upper</span>, fill <span class="op">=</span> <span class="va">type</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">trend_flags</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Date</span>, y <span class="op">=</span> <span class="va">Value</span><span class="op">)</span>, shape<span class="op">=</span><span class="fl">23</span>, size<span class="op">=</span><span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Date"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Flu hospitalizations"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Trend component\nNot flagged but change point in seed"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="planes-components_files/figure-html/unnamed-chunk-66-1.png" width="672"></p>
</div>
</div>
<div class="section level2">
<h2 id="shape---plane_shape">Shape - <code>plane_shape()</code><a class="anchor" aria-label="anchor" href="#shape---plane_shape"></a>
</h2>
<p>The shape component evaluates the shape of the trajectory of the
forecast signal and compares that shape to existing shapes in the
observed seed data. If the shape is identified as novel, a flag is
raised, and the signal is considered implausible.</p>
<p>This function uses Dynamic Time Warping (DTW) to identify shapes and
flag novel shapes. This function works in three broad steps. First, the
prepared seed data is divided into a set of sliding windows, each
representing a subset of the total trajectory shape of the observed
data. Second, shape-based DTW distances are calculated for every
combination of the observed sliding windows, and these distances are
used to calibrate a distance threshold that will define whether or not a
signal shape is novel. Third, we calculate DTW distances between the
forecast signal and each of the observed sliding windows. If any of
those distances are less than the defined threshold, the shape is not
novel, no flag is raised, and the forecast is considered plausible.</p>
<p>For more information on the shape algorithm, see
<code>?plane_shape()</code>.</p>
<div class="section level3">
<h3 id="flagged-as-implausible-5">Flagged as implausible<a class="anchor" aria-label="anchor" href="#flagged-as-implausible-5"></a>
</h3>
<p>In the example below, we set the point estimates and prediction
intervals of the forecast signal to a shape that is novel compared to
the seed data (see plot below).</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">point_est</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">60</span>, <span class="fl">60</span>, <span class="fl">60</span>, <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="va">prepped_forecast</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    location <span class="op">=</span> <span class="st">"01"</span>,</span>
<span>    date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2022-06-11"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2022-07-02"</span><span class="op">)</span>, by <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>,</span>
<span>    horizon <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,</span>
<span>    lower <span class="op">=</span> <span class="va">point_est</span> <span class="op">-</span> <span class="fl">10</span>,</span>
<span>    <span class="co">## make an unusual shape in hospitalizations to trigger shape component</span></span>
<span>    point <span class="op">=</span> <span class="va">point_est</span>,</span>
<span>    upper <span class="op">=</span> <span class="va">point_est</span> <span class="op">+</span> <span class="fl">10</span>,</span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/to_signal.html">to_signal</a></span><span class="op">(</span>outcome <span class="op">=</span> <span class="st">"flu.admits"</span>, type <span class="op">=</span> <span class="st">"forecast"</span>, horizon <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prepped_forecast</span><span class="op">$</span><span class="va">data</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">location</th>
<th align="left">date</th>
<th align="right">horizon</th>
<th align="right">lower</th>
<th align="right">point</th>
<th align="right">upper</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">01</td>
<td align="left">2022-06-11</td>
<td align="right">1</td>
<td align="right">50</td>
<td align="right">60</td>
<td align="right">70</td>
</tr>
<tr class="even">
<td align="left">01</td>
<td align="left">2022-06-18</td>
<td align="right">2</td>
<td align="right">50</td>
<td align="right">60</td>
<td align="right">70</td>
</tr>
<tr class="odd">
<td align="left">01</td>
<td align="left">2022-06-25</td>
<td align="right">3</td>
<td align="right">50</td>
<td align="right">60</td>
<td align="right">70</td>
</tr>
<tr class="even">
<td align="left">01</td>
<td align="left">2022-07-02</td>
<td align="right">4</td>
<td align="right">0</td>
<td align="right">10</td>
<td align="right">20</td>
</tr>
</tbody>
</table>
<p>We would expect an implausibility flag to be raised for this
example:</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plane_shape.html">plane_shape</a></span><span class="op">(</span>location <span class="op">=</span> <span class="st">"01"</span>, input <span class="op">=</span> <span class="va">prepped_forecast</span>, seed <span class="op">=</span> <span class="va">prepped_seed</span><span class="op">)</span></span>
<span><span class="co">#&gt; $indicator</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>The indicator is <code>TRUE</code>, meaning that the forecast is
implausible, because the shape is novel relative to the seed data.</p>
<p>We can visualize the shape differences and see why this shape is
flagged. The forecast in the plot below (red line) clearly looks
different than any shape in the observed seed data (blue line):</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">shape_dat</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">prepped_forecast</span><span class="op">$</span><span class="va">data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"forecast"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>flu.admits <span class="op">=</span> <span class="va">point</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">observed_signal</span><span class="op">$</span><span class="va">data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">location</span> <span class="op">==</span> <span class="st">"01"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">date</span> <span class="op">&lt;=</span> <span class="st">"2022-06-04"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">"observed"</span><span class="op">)</span>, <span class="va">.</span> <span class="op">)</span></span>
<span></span>
<span><span class="va">shape_flags</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">shape_dat</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"forecast"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">shape_dat</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">flu.admits</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>lty <span class="op">=</span> <span class="st">"dotted"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">lower</span>, ymax <span class="op">=</span> <span class="va">upper</span>, fill <span class="op">=</span> <span class="va">type</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">shape_flags</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">flu.admits</span><span class="op">)</span>, shape<span class="op">=</span><span class="fl">23</span>, size<span class="op">=</span><span class="fl">4</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Date"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Flu hospitalizations"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Shape component\nFlagged"</span><span class="op">)</span></span></code></pre></div>
<p><img src="planes-components_files/figure-html/unnamed-chunk-71-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="not-flagged-as-implausible-5">Not flagged as implausible<a class="anchor" aria-label="anchor" href="#not-flagged-as-implausible-5"></a>
</h3>
<p>Next we’ll look at an example of a forecast with a familiar shape
that shouldn’t trigger a flag:</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">point_est</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">35</span>, <span class="fl">18</span>, <span class="fl">30</span>, <span class="fl">20</span><span class="op">)</span></span>
<span></span>
<span><span class="va">prepped_forecast</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    location <span class="op">=</span> <span class="st">"01"</span>,</span>
<span>    date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2022-06-11"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2022-07-02"</span><span class="op">)</span>, by <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>,</span>
<span>    horizon <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,</span>
<span>    lower <span class="op">=</span> <span class="va">point_est</span> <span class="op">-</span> <span class="fl">10</span>,</span>
<span>    <span class="co">## make a familiar shape in hospitalizations to not trigger shape component</span></span>
<span>    point <span class="op">=</span> <span class="va">point_est</span>,</span>
<span>    upper <span class="op">=</span> <span class="va">point_est</span> <span class="op">+</span> <span class="fl">10</span>,</span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/to_signal.html">to_signal</a></span><span class="op">(</span>outcome <span class="op">=</span> <span class="st">"flu.admits"</span>, type <span class="op">=</span> <span class="st">"forecast"</span>, horizon <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prepped_forecast</span><span class="op">$</span><span class="va">data</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">location</th>
<th align="left">date</th>
<th align="right">horizon</th>
<th align="right">lower</th>
<th align="right">point</th>
<th align="right">upper</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">01</td>
<td align="left">2022-06-11</td>
<td align="right">1</td>
<td align="right">25</td>
<td align="right">35</td>
<td align="right">45</td>
</tr>
<tr class="even">
<td align="left">01</td>
<td align="left">2022-06-18</td>
<td align="right">2</td>
<td align="right">8</td>
<td align="right">18</td>
<td align="right">28</td>
</tr>
<tr class="odd">
<td align="left">01</td>
<td align="left">2022-06-25</td>
<td align="right">3</td>
<td align="right">20</td>
<td align="right">30</td>
<td align="right">40</td>
</tr>
<tr class="even">
<td align="left">01</td>
<td align="left">2022-07-02</td>
<td align="right">4</td>
<td align="right">10</td>
<td align="right">20</td>
<td align="right">30</td>
</tr>
</tbody>
</table>
<p>We would not expect an implausibility flag to be raised for this
example:</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plane_shape.html">plane_shape</a></span><span class="op">(</span>location <span class="op">=</span> <span class="st">"01"</span>, input <span class="op">=</span> <span class="va">prepped_forecast</span>, seed <span class="op">=</span> <span class="va">prepped_seed</span><span class="op">)</span></span>
<span><span class="co">#&gt; $indicator</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
<p>The indicator is <code>FALSE</code>, meaning that the forecast is
considered plausible, because the shape is familiar relative to the seed
data.</p>
<p>We can visualize the shape similarities/differences and see why this
shape is not flagged. The forecast in the plot below (red line) looks
very similar to the shape that we see in the observed seed data (blue
line) between mid April and mid June:</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">shape_dat</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">prepped_forecast</span><span class="op">$</span><span class="va">data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"forecast"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>flu.admits <span class="op">=</span> <span class="va">point</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">observed_signal</span><span class="op">$</span><span class="va">data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">location</span> <span class="op">==</span> <span class="st">"01"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">date</span> <span class="op">&lt;=</span> <span class="st">"2022-06-04"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">"observed"</span><span class="op">)</span>, <span class="va">.</span> <span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">shape_dat</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">flu.admits</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>lty <span class="op">=</span> <span class="st">"dotted"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">lower</span>, ymax <span class="op">=</span> <span class="va">upper</span>, fill <span class="op">=</span> <span class="va">type</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Date"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Flu hospitalizations"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Shape component\nNot Flagged"</span><span class="op">)</span></span></code></pre></div>
<p><img src="planes-components_files/figure-html/unnamed-chunk-76-1.png" width="672"></p>
</div>
</div>
<div class="section level2">
<h2 id="zero---plane_zero">Zero - <code>plane_zero()</code><a class="anchor" aria-label="anchor" href="#zero---plane_zero"></a>
</h2>
<p>This function checks for the presence of any value(s) equal to zero
in the evaluated signal. If there are any zeros found, then the function
will look in the seed to see if there are zeros anywhere else in the
time series. If so, the function will consider the evaluated zero
plausible and no flags will be raised (i.e., indicator returned as
<code>FALSE</code>). If not, the function will consider the evaluated
zero implausible and a flag will be raised (i.e., indicator returned as
<code>TRUE</code>). This function can be used on either forecast or
observed signals.</p>
<div class="section level3">
<h3 id="flagged-as-implausible-6">Flagged as implausible<a class="anchor" aria-label="anchor" href="#flagged-as-implausible-6"></a>
</h3>
<p>In the example below, we add a zero to the signal point estimate to a
location for which the seed has no zeros:</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">point_est</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">31</span>, <span class="fl">30</span>, <span class="fl">31</span>, <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="va">prepped_forecast</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    location <span class="op">=</span> <span class="st">"01"</span>,</span>
<span>    date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2022-06-11"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2022-07-02"</span><span class="op">)</span>, by <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>,</span>
<span>    horizon <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,</span>
<span>    lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">26</span>,<span class="fl">24</span>,<span class="fl">24</span>,<span class="fl">0</span><span class="op">)</span>,</span>
<span>    <span class="co">## add zeros in hospitalizations to trigger zero component</span></span>
<span>    point <span class="op">=</span> <span class="va">point_est</span>,</span>
<span>    upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">36</span>,<span class="fl">36</span>,<span class="fl">38</span>,<span class="fl">15</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/to_signal.html">to_signal</a></span><span class="op">(</span>outcome <span class="op">=</span> <span class="st">"flu.admits"</span>, type <span class="op">=</span> <span class="st">"forecast"</span>, horizon <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prepped_forecast</span><span class="op">$</span><span class="va">data</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">location</th>
<th align="left">date</th>
<th align="right">horizon</th>
<th align="right">lower</th>
<th align="right">point</th>
<th align="right">upper</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">01</td>
<td align="left">2022-06-11</td>
<td align="right">1</td>
<td align="right">26</td>
<td align="right">31</td>
<td align="right">36</td>
</tr>
<tr class="even">
<td align="left">01</td>
<td align="left">2022-06-18</td>
<td align="right">2</td>
<td align="right">24</td>
<td align="right">30</td>
<td align="right">36</td>
</tr>
<tr class="odd">
<td align="left">01</td>
<td align="left">2022-06-25</td>
<td align="right">3</td>
<td align="right">24</td>
<td align="right">31</td>
<td align="right">38</td>
</tr>
<tr class="even">
<td align="left">01</td>
<td align="left">2022-07-02</td>
<td align="right">4</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">15</td>
</tr>
</tbody>
</table>
<p>The seed stores a logical indicating whether any zeros are present in
the seed data, and there are none in this example:</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prepped_seed</span><span class="op">$</span><span class="va">`01`</span><span class="op">$</span><span class="va">any_zeros</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
<p>We would then expect an implausibility flag to be raised for this
location:</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plane_zero.html">plane_zero</a></span><span class="op">(</span>location <span class="op">=</span> <span class="st">"01"</span>, input <span class="op">=</span> <span class="va">prepped_forecast</span>, seed <span class="op">=</span> <span class="va">prepped_seed</span><span class="op">)</span></span>
<span><span class="co">#&gt; $indicator</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>The indicator is <code>TRUE</code>, meaning that the forecast signal
is implausible because there are zeros in the forecast signal but not in
the observed seed.</p>
<p>We can visualize this below. The signal in red (a forecast in this
example) has a zero in early July, but there were no zeros found in the
seed data in blue.</p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">zero_dat</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">prepped_forecast</span><span class="op">$</span><span class="va">data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"forecast"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>flu.admits <span class="op">=</span> <span class="va">point</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">observed_signal</span><span class="op">$</span><span class="va">data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">location</span> <span class="op">==</span> <span class="st">"01"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">date</span> <span class="op">&lt;=</span> <span class="st">"2022-06-04"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">"observed"</span><span class="op">)</span>, <span class="va">.</span> <span class="op">)</span></span>
<span></span>
<span><span class="va">zero_flags</span> <span class="op">&lt;-</span> <span class="va">zero_dat</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">flu.admits</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="va">zero_dat</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">flu.admits</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>lty <span class="op">=</span> <span class="st">"dotted"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">zero_flags</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">flu.admits</span><span class="op">)</span>, shape<span class="op">=</span><span class="fl">23</span>, size<span class="op">=</span><span class="fl">4</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">lower</span>, ymax <span class="op">=</span> <span class="va">upper</span>, fill <span class="op">=</span> <span class="va">type</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Date"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Flu hospitalizations"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Zero component\nFlagged"</span><span class="op">)</span></span></code></pre></div>
<p><img src="planes-components_files/figure-html/unnamed-chunk-82-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="not-flagged-as-implausible-6">Not flagged as implausible<a class="anchor" aria-label="anchor" href="#not-flagged-as-implausible-6"></a>
</h3>
<p>This function will only trigger an implausibility flag if there is a
zero in the signal (either observed or forecast) and there is not one in
the seed. In other words, no flag will be raised when: (1) there are no
zeros in the signal or (2) there are any zeros in the seed.</p>
<p>Let’s look at an example where there are zeros in the signal
(location “02”) and in the seed. No flag should be triggered:</p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">point_est</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">6</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">prepped_forecast</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    location <span class="op">=</span> <span class="st">"02"</span>,</span>
<span>    date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2022-06-11"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2022-07-02"</span><span class="op">)</span>, by <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>,</span>
<span>    horizon <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,</span>
<span>    lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">5</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,</span>
<span>    <span class="co">## add zeros in hospitalizations</span></span>
<span>    point <span class="op">=</span> <span class="va">point_est</span>,</span>
<span>    upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">7</span>,<span class="fl">4</span>,<span class="fl">5</span><span class="op">)</span>,</span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/to_signal.html">to_signal</a></span><span class="op">(</span>outcome <span class="op">=</span> <span class="st">"flu.admits"</span>, type <span class="op">=</span> <span class="st">"forecast"</span>, horizon <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prepped_forecast</span><span class="op">$</span><span class="va">data</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">location</th>
<th align="left">date</th>
<th align="right">horizon</th>
<th align="right">lower</th>
<th align="right">point</th>
<th align="right">upper</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">02</td>
<td align="left">2022-06-11</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">02</td>
<td align="left">2022-06-18</td>
<td align="right">2</td>
<td align="right">5</td>
<td align="right">6</td>
<td align="right">7</td>
</tr>
<tr class="odd">
<td align="left">02</td>
<td align="left">2022-06-25</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">02</td>
<td align="left">2022-07-02</td>
<td align="right">4</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="right">5</td>
</tr>
</tbody>
</table>
<p>The seed stores a logical indicating whether any zeros are present in
the seed data, and there are zeros in this example:</p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prepped_seed</span><span class="op">$</span><span class="va">`02`</span><span class="op">$</span><span class="va">any_zeros</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>We then would not expect an implausibility flag to be raised for this
location:</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plane_zero.html">plane_zero</a></span><span class="op">(</span>location <span class="op">=</span> <span class="st">"02"</span>, input <span class="op">=</span> <span class="va">prepped_forecast</span>, seed <span class="op">=</span> <span class="va">prepped_seed</span><span class="op">)</span></span>
<span><span class="co">#&gt; $indicator</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
<p>The indicator is <code>FALSE</code>, meaning that the forecast signal
is plausible, because there are zeros in the forecast signal and in the
observed seed.</p>
<p>We can visualize this below. The signal in red (a forecast in this
example) has a zero around early-mid June, but there were also zeros
found in the seed data in blue.</p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">zero_dat</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">prepped_forecast</span><span class="op">$</span><span class="va">data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"forecast"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>flu.admits <span class="op">=</span> <span class="va">point</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">observed_signal</span><span class="op">$</span><span class="va">data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">location</span> <span class="op">==</span> <span class="st">"02"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">date</span> <span class="op">&lt;=</span> <span class="st">"2022-06-04"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">"observed"</span><span class="op">)</span>, <span class="va">.</span> <span class="op">)</span></span>
<span></span>
<span><span class="va">zero_flags</span> <span class="op">&lt;-</span> <span class="va">zero_dat</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">flu.admits</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="va">zero_dat</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">flu.admits</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>lty <span class="op">=</span> <span class="st">"dotted"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">zero_flags</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">flu.admits</span><span class="op">)</span>, shape<span class="op">=</span><span class="fl">23</span>, size<span class="op">=</span><span class="fl">4</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>ymin <span class="op">=</span> <span class="va">lower</span>, ymax <span class="op">=</span> <span class="va">upper</span>, fill <span class="op">=</span> <span class="va">type</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Date"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Flu hospitalizations"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Zero component\nNot Flagged"</span><span class="op">)</span></span></code></pre></div>
<p><img src="planes-components_files/figure-html/unnamed-chunk-88-1.png" width="672"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by VP Nagraj, Desiree Williams, Amy Benefield.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
