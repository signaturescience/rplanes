<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="rplanes">
<title>Basic Usage • rplanes</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Basic Usage">
<meta property="og:description" content="rplanes">
<meta property="og:image" content="https://signaturescience.github.io/rplanes/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">rplanes</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9001</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/basic-usage.html">Basic Usage</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Basic Usage</h1>
            
      
      
      <div class="d-none name"><code>basic-usage.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>The <code>rplanes</code> package (<strong>pl</strong>ausibility
<strong>an</strong>alysis of <strong>e</strong>pidemiological
<strong>s</strong>ignals) provides functionality to prepare data and
analyze plausibility of both forecasted and observed epidemiological
signals. The functions implement a set of plausibility algorithms that
are agnostic to geographic and time resolutions and are calculated
independently and then presented as a combined score. The package allows
users to:</p>
<ol style="list-style-type: decimal">
<li>Prepare signal data (either forecast or observed) to be
evaluated</li>
<li>Create a set of baseline characteristics for previously observed
data</li>
<li>Compare those characteristics to the evaluated data for each
location</li>
<li>Synthesize individual component results into an overall score</li>
</ol>
<p>The package workflow is demonstrated in detail below (see
<strong>Figure 1</strong>).</p>
<div class="figure">
<img src="workflow.png" id="id" class="class" style="width:90.0%;height:100.0%" alt=""><p class="caption"><strong>Figure 1</strong>: Workflow of the rplanes
package</p>
</div>
<p><strong>Figure 1</strong> provides a detailed description of the
workflow used in <code>rplanes</code>. The <code>rplanes</code>
processing begins with forecast or observed data prepared in a
pre-specified format. The required input data format is documented in
the package. For convenience, the package includes the
<code><a href="../reference/read_forecast.html">read_forecast()</a></code> function to prepare forecast data that is
in the quantile format commonly used in forecasting hubs. The prepped
forecast or observed data is then converted to a signal object using
<code><a href="../reference/to_signal.html">to_signal()</a></code>. The signal data will be compared against
baseline characteristics for previously observed data at each location.
These characteristics are aggregated using <code><a href="../reference/plane_seed.html">plane_seed()</a></code>.
With the seed and the signal data prepared, the user can run the
plausibility scoring independently for each location in the evaluated
data. Scores are comprised of individual binary plausibility components.
The functions that drive each component are wrapped in the
<code><a href="../reference/plane_score.html">plane_score()</a></code> function for ease-of-use. By default the
<code><a href="../reference/plane_score.html">plane_score()</a></code> wrapper will try to use all relevant
components, however the user can dictate specific components as needed.
It is important to note that depending on the type of signal to be
evaluated (i.e., forecast versus observed data), some components may not
apply.</p>
</div>
<div class="section level2">
<h2 id="analyzing-plausibility-of-forecast-data">Analyzing plausibility of forecast data<a class="anchor" aria-label="anchor" href="#analyzing-plausibility-of-forecast-data"></a>
</h2>
<p>Plausibility analysis can support operational forecasting and
outbreak analytic activities. Here we demonstrate how to use
<code>rplanes</code> to score an example forecasted data set.</p>
<p>Several packages must be loaded to prior to conducting the
analysis:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://signaturescience.github.io/rplanes/">rplanes</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="prepare-observed-data">Prepare observed data<a class="anchor" aria-label="anchor" href="#prepare-observed-data"></a>
</h3>
<p>To motivate this example we will use incident flu hospitalization
reported via <a href="https://healthdata.gov/Hospital/COVID-19-Reported-Patient-Impact-and-Hospital-Capa/g62h-syeh" class="external-link">HHS
Protect</a>. Note that the data here has been aggregated from daily to
weekly resolution, and is provided in this format as internal
<code>rplanes</code> package data. We select only the columns in which
we’re interested (“date”, “location”, and “flu.admits”) and make sure
that the date field is formatted as a date:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hosp_all</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/observed/hdgov_hosp_weekly.csv"</span>, package <span class="op">=</span> <span class="st">"rplanes"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">location</span>, <span class="va">flu.admits</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">hosp_all</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">date</th>
<th align="left">location</th>
<th align="right">flu.admits</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">2022-02-12</td>
<td align="left">US</td>
<td align="right">1256</td>
</tr>
<tr class="even">
<td align="left">2022-02-19</td>
<td align="left">US</td>
<td align="right">1573</td>
</tr>
<tr class="odd">
<td align="left">2022-02-26</td>
<td align="left">US</td>
<td align="right">1666</td>
</tr>
<tr class="even">
<td align="left">2022-03-05</td>
<td align="left">US</td>
<td align="right">1942</td>
</tr>
<tr class="odd">
<td align="left">2022-03-12</td>
<td align="left">US</td>
<td align="right">2247</td>
</tr>
<tr class="even">
<td align="left">2022-03-19</td>
<td align="left">US</td>
<td align="right">2878</td>
</tr>
</tbody>
</table>
<p>It is important to emphasize that the observed data must at minimum
include columns for location (geographic unit such as FIPS code), date
(date of reported value; must be date class), and a reported value for
each location/date combination.</p>
</div>
<div class="section level3">
<h3 id="convert-observed-data-into-a-signal-with-to_signal">Convert observed data into a signal with
<code>to_signal()</code><a class="anchor" aria-label="anchor" href="#convert-observed-data-into-a-signal-with-to_signal"></a>
</h3>
<p>The downstream plausibility analysis requires that observed and/or
forecasted data be converted to an S3 “signal” class. The
<code><a href="../reference/to_signal.html">to_signal()</a></code> function constructs this object and applies an
additional “observed” or “forecast” class depending on the type of
signal specified.</p>
<p>Here we will convert the observed data from above to a signal
object:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">observed_signal</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/to_signal.html">to_signal</a></span><span class="op">(</span>input <span class="op">=</span> <span class="va">hosp_all</span>, outcome <span class="op">=</span> <span class="st">"flu.admits"</span>, type <span class="op">=</span> <span class="st">"observed"</span>, resolution <span class="op">=</span> <span class="st">"weeks"</span>, horizon <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="create-a-seed-from-the-observed-data-via-plane_seed">Create a seed from the observed data via
<code>plane_seed()</code><a class="anchor" aria-label="anchor" href="#create-a-seed-from-the-observed-data-via-plane_seed"></a>
</h3>
<p>The <code><a href="../reference/plane_seed.html">plane_seed()</a></code> function provides a means to internally
calculate and store baseline characteristics for the observed data in
what the package calls a “seed”. These characteristics are summarized
independently for each location, and are then used in downstream scoring
functions.</p>
<p>In this example, we input the prepped observed signal object and make
use of the “cut_date” argument. By restricting to dates on or before the
specified cut date, we ensure that the baseline characteristics are not
computed based on data that overlaps with the forecast. In practice, it
may be possible to use the default (<code>NULL</code>) cut date when
analyzing forecasts, so long as the reported data is available up to
(and not exceeding) the first horizon of the forecast.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prepped_seed</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plane_seed.html">plane_seed</a></span><span class="op">(</span><span class="va">observed_signal</span>, cut_date <span class="op">=</span> <span class="st">"2022-10-29"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="prepare-forecast-data">Prepare forecast data<a class="anchor" aria-label="anchor" href="#prepare-forecast-data"></a>
</h3>
<p>The forecast data to be assessed must include a point estimate and
some representation of uncertainty (i.e., prediction interval) for each
location and horizon. For analysis in <code>rplanes</code>, the forecast
data must be prepared to include the following:</p>
<ul>
<li>
<code>location</code>: Geographic unit such as FIPS code</li>
<li>
<code>date</code>: Date corresponding the forecast horizon</li>
<li>
<code>horizon</code>: Forecast horizon</li>
<li>
<code>lower</code>: Lower limit of a given prediction interval for
the forecast</li>
<li>
<code>point</code>: Point estimate for the forecast</li>
<li>
<code>upper</code>: Upper limit of a given prediction interval for
the forecast</li>
</ul>
<p>For convenience, the <code>rplanes</code> package includes
<code><a href="../reference/read_forecast.html">read_forecast()</a></code> to convert forecasts from a quantile format
used by many forecast hubs<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;&lt;a href="https://github.com/reichlab/covid19-forecast-hub" class="external-link uri"&gt;https://github.com/reichlab/covid19-forecast-hub&lt;/a&gt;&lt;/p&gt;'><sup>1</sup></a><sup>,</sup><a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;&lt;a href="https://github.com/cdcepi/Flusight-forecast-data" class="external-link uri"&gt;https://github.com/cdcepi/Flusight-forecast-data&lt;/a&gt;&lt;/p&gt;'><sup>2</sup></a> into the format needed
for plausibility analysis. The <code><a href="../reference/read_forecast.html">read_forecast()</a></code> function
reads csv input and returns a <code>tibble</code> with summarized
forecast data for each location and horizon in the original file.</p>
<p>For this example, we use a forecast of incident weekly flu
hospitalizations. This forecast is originally in the quantile format
referenced above and is included in <code>rplanes</code> as example
data:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">forecast_fp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/forecast/2022-10-31-SigSci-TSENS.csv"</span>, package <span class="op">=</span> <span class="st">"rplanes"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="va">forecast_fp</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="16%">
<col width="27%">
<col width="18%">
<col width="10%">
<col width="10%">
<col width="10%">
<col width="6%">
</colgroup>
<thead><tr class="header">
<th align="left">forecast_date</th>
<th align="left">target</th>
<th align="left">target_end_date</th>
<th align="left">location</th>
<th align="left">type</th>
<th align="right">quantile</th>
<th align="right">value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">2022-10-31</td>
<td align="left">1 wk ahead inc flu hosp</td>
<td align="left">2022-11-05</td>
<td align="left">02</td>
<td align="left">point</td>
<td align="right">NA</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="left">2022-10-31</td>
<td align="left">2 wk ahead inc flu hosp</td>
<td align="left">2022-11-12</td>
<td align="left">02</td>
<td align="left">point</td>
<td align="right">NA</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="left">2022-10-31</td>
<td align="left">3 wk ahead inc flu hosp</td>
<td align="left">2022-11-19</td>
<td align="left">02</td>
<td align="left">point</td>
<td align="right">NA</td>
<td align="right">5</td>
</tr>
<tr class="even">
<td align="left">2022-10-31</td>
<td align="left">4 wk ahead inc flu hosp</td>
<td align="left">2022-11-26</td>
<td align="left">02</td>
<td align="left">point</td>
<td align="right">NA</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="left">2022-10-31</td>
<td align="left">1 wk ahead inc flu hosp</td>
<td align="left">2022-11-05</td>
<td align="left">02</td>
<td align="left">quantile</td>
<td align="right">0.01</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">2022-10-31</td>
<td align="left">2 wk ahead inc flu hosp</td>
<td align="left">2022-11-12</td>
<td align="left">02</td>
<td align="left">quantile</td>
<td align="right">0.01</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p>We can use <code><a href="../reference/read_forecast.html">read_forecast()</a></code> to load the data and convert
to the required format:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prepped_forecast</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_forecast.html">read_forecast</a></span><span class="op">(</span><span class="va">forecast_fp</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">prepped_forecast</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">location</th>
<th align="left">date</th>
<th align="left">horizon</th>
<th align="right">lower</th>
<th align="right">point</th>
<th align="right">upper</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">02</td>
<td align="left">2022-11-05</td>
<td align="left">1</td>
<td align="right">0</td>
<td align="right">6</td>
<td align="right">11</td>
</tr>
<tr class="even">
<td align="left">02</td>
<td align="left">2022-11-12</td>
<td align="left">2</td>
<td align="right">0</td>
<td align="right">5</td>
<td align="right">12</td>
</tr>
<tr class="odd">
<td align="left">02</td>
<td align="left">2022-11-19</td>
<td align="left">3</td>
<td align="right">0</td>
<td align="right">5</td>
<td align="right">12</td>
</tr>
<tr class="even">
<td align="left">02</td>
<td align="left">2022-11-26</td>
<td align="left">4</td>
<td align="right">0</td>
<td align="right">5</td>
<td align="right">12</td>
</tr>
<tr class="odd">
<td align="left">04</td>
<td align="left">2022-11-05</td>
<td align="left">1</td>
<td align="right">13</td>
<td align="right">58</td>
<td align="right">103</td>
</tr>
<tr class="even">
<td align="left">04</td>
<td align="left">2022-11-12</td>
<td align="left">2</td>
<td align="right">9</td>
<td align="right">68</td>
<td align="right">127</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="convert-forecast-data-into-a-signal-with-to_signal">Convert forecast data into a signal with
<code>to_signal()</code><a class="anchor" aria-label="anchor" href="#convert-forecast-data-into-a-signal-with-to_signal"></a>
</h3>
<p>With the forecast formatted appropriately, we can convert it to a
signal object:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">forecast_signal</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">prepped_forecast</span>  <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/to_signal.html">to_signal</a></span><span class="op">(</span><span class="va">.</span>, outcome <span class="op">=</span> <span class="st">"flu.admits"</span>, type <span class="op">=</span> <span class="st">"forecast"</span>, resolution <span class="op">=</span> <span class="st">"weeks"</span>, horizon <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="run-plane_score-and-visualize-results">Run <code>plane_score()</code> and visualize results<a class="anchor" aria-label="anchor" href="#run-plane_score-and-visualize-results"></a>
</h3>
<p>The <code>planes_score()</code> function wraps PLANES scoring for
plausibility components across all locations in a single step. The
function can accept arguments to specific component functions and allows
the user to dictate which components to use (with a default to all). For
more about these arguments see <code><a href="../reference/plane_score.html">?plane_score</a></code>.</p>
<p>We pass the input forecast signal to the function along with the
prepped seed to run the scoring independently at all locations:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">scores</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plane_score.html">plane_score</a></span><span class="op">(</span>input <span class="op">=</span> <span class="va">forecast_signal</span>, seed <span class="op">=</span> <span class="va">prepped_seed</span><span class="op">)</span></span></code></pre></div>
<p>Note that if we had other forecasts to evaluate for the same time
period, we could prepare each forecast signal appropriately and use the
same seed (i.e., we would not have to recreate the seed for each
forecast).</p>
<p>The output of <code><a href="../reference/plane_score.html">plane_score()</a></code> is a list of scoring results
for all locations. We can convert the <code>scores_summary</code>
element from that list to a <code>tibble</code>. The <code>res</code>
object below shows the location, the number of flags raised (“n_flags”),
the number of components tested (“n_components”), the “score” (which is
“n_flags” divided by “n_components”), the names of components tested,
and the names of the components that were flagged (if any):</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">scores</span><span class="op">$</span><span class="va">scores_summary</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">map_df</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">as_tibble</span><span class="op">)</span></span>
<span>  </span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="10%">
<col width="9%">
<col width="15%">
<col width="7%">
<col width="35%">
<col width="21%">
</colgroup>
<thead><tr class="header">
<th align="left">location</th>
<th align="right">n_flags</th>
<th align="right">n_components</th>
<th align="right">score</th>
<th align="left">components</th>
<th align="left">flagged</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">02</td>
<td align="right">1</td>
<td align="right">5</td>
<td align="right">0.2</td>
<td align="left">cover;diff;repeat;taper;trend</td>
<td align="left">cover</td>
</tr>
<tr class="even">
<td align="left">04</td>
<td align="right">0</td>
<td align="right">5</td>
<td align="right">0.0</td>
<td align="left">cover;diff;repeat;taper;trend</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">05</td>
<td align="right">0</td>
<td align="right">5</td>
<td align="right">0.0</td>
<td align="left">cover;diff;repeat;taper;trend</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">06</td>
<td align="right">0</td>
<td align="right">5</td>
<td align="right">0.0</td>
<td align="left">cover;diff;repeat;taper;trend</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">08</td>
<td align="right">0</td>
<td align="right">5</td>
<td align="right">0.0</td>
<td align="left">cover;diff;repeat;taper;trend</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">09</td>
<td align="right">3</td>
<td align="right">5</td>
<td align="right">0.6</td>
<td align="left">cover;diff;repeat;taper;trend</td>
<td align="left">cover;diff;repeat</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">score</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>score <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">score</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">score</span>,<span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Score"</span>, y <span class="op">=</span> <span class="st">"Count"</span><span class="op">)</span></span></code></pre></div>
<p><img src="basic-usage_files/figure-html/unnamed-chunk-15-1.png" width="672" style="display: block; margin: auto;"></p>
<p>For the evaluated forecast, most of the locations had one or fewer of
the flags raised. However, several locations had two or three of the
five possible components flagged for implausibility.</p>
</div>
</div>
<div class="section level2">
<h2 id="analyzing-plausibility-of-observed-data">Analyzing plausibility of observed data<a class="anchor" aria-label="anchor" href="#analyzing-plausibility-of-observed-data"></a>
</h2>
<p>One might want to test observed or reported data for plausibility to
check for phenomena like backfill or systematic errors in reporting
mechanisms. The steps to use <code>rplanes</code> to analyze
plausibility of observed data are very similar to forecast assessments.
The input data must be converted to a signal, which is passed (along
with a seed) to the scoring function. However, the key difference is
that for observed data the same data source used to create the input
signal can be used for seeding, albeit with a cut date to differentiate
data to be evaluated from baseline.</p>
<div class="section level3">
<h3 id="prepare-observed-data-1">Prepare observed data<a class="anchor" aria-label="anchor" href="#prepare-observed-data-1"></a>
</h3>
<p>For this example, we will also use the reported HHS Protect flu
hospitalization data. However, we will truncate this data to stop at the
end of 2022. In this scenario, we will be interested in assessing the
most recent reported week (i.e., the week of 2022-12-31) for
plausibility.</p>
<p>Note that in practice, it may be of interest to assess multiple time
points for recently observed data.</p>
<p>To begin, we will read in the data and filter it to dates prior to
2023:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hosp_pre23</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/observed/hdgov_hosp_weekly.csv"</span>, package <span class="op">=</span> <span class="st">"rplanes"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">location</span>, <span class="va">flu.admits</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">date</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2023-01-01"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">hosp_pre23</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">date</th>
<th align="left">location</th>
<th align="right">flu.admits</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">2022-02-12</td>
<td align="left">US</td>
<td align="right">1256</td>
</tr>
<tr class="even">
<td align="left">2022-02-19</td>
<td align="left">US</td>
<td align="right">1573</td>
</tr>
<tr class="odd">
<td align="left">2022-02-26</td>
<td align="left">US</td>
<td align="right">1666</td>
</tr>
<tr class="even">
<td align="left">2022-03-05</td>
<td align="left">US</td>
<td align="right">1942</td>
</tr>
<tr class="odd">
<td align="left">2022-03-12</td>
<td align="left">US</td>
<td align="right">2247</td>
</tr>
<tr class="even">
<td align="left">2022-03-19</td>
<td align="left">US</td>
<td align="right">2878</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="convert-observed-data-into-a-signal-with-to_signal-1">Convert observed data into a signal with
<code>to_signal()</code><a class="anchor" aria-label="anchor" href="#convert-observed-data-into-a-signal-with-to_signal-1"></a>
</h3>
<p>With the data loaded, we can convert the hospitalization
<code>tibble</code> to a signal object:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">observed_signal</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/to_signal.html">to_signal</a></span><span class="op">(</span>input <span class="op">=</span> <span class="va">hosp_pre23</span>, outcome <span class="op">=</span> <span class="st">"flu.admits"</span>, type <span class="op">=</span> <span class="st">"observed"</span>, resolution <span class="op">=</span> <span class="st">"weeks"</span>, horizon <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="create-a-seed-from-the-observed-data-via-plane_seed-1">Create a seed from the observed data via
<code>plane_seed()</code><a class="anchor" aria-label="anchor" href="#create-a-seed-from-the-observed-data-via-plane_seed-1"></a>
</h3>
<p>We can use the observed the signal as the input to
<code><a href="../reference/plane_score.html">plane_score()</a></code>, but also as the input to
<code><a href="../reference/plane_seed.html">plane_seed()</a></code>. However, to do so we must use an argument
that restricts the seeding to <em>only</em> dates prior to the cut date
(inclusive).</p>
<p>In this example, because we are assessing the observed data for the
week of 2022-12-31 we would want to seed our plausibility analysis with
characteristics up through the most recent reported date (i.e.,
2022-12-24):</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prepped_seed</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plane_seed.html">plane_seed</a></span><span class="op">(</span><span class="va">observed_signal</span>, cut_date <span class="op">=</span> <span class="st">"2022-12-24"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="run-plane_score-and-visualize-results-1">Run <code>plane_score()</code> and visualize results<a class="anchor" aria-label="anchor" href="#run-plane_score-and-visualize-results-1"></a>
</h3>
<p>As with the forecast assessments, the PLANES scoring is wrapped for
convenience in the <code><a href="../reference/plane_score.html">plane_score()</a></code> function. Since we are
assessing an observed signal in this case, we can explicitly tell the
scoring to use certain components. It is important to emphasize that not
all components will work for both forecasts and observed signals:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">scores</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plane_score.html">plane_score</a></span><span class="op">(</span><span class="va">observed_signal</span>, seed <span class="op">=</span> <span class="va">prepped_seed</span>, components <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"repeat"</span>,<span class="st">"diff"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">scores</span><span class="op">$</span><span class="va">scores_summary</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">map_df</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">as_tibble</span><span class="op">)</span></span>
<span>  </span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">location</th>
<th align="right">n_flags</th>
<th align="right">n_components</th>
<th align="right">score</th>
<th align="left">components</th>
<th align="left">flagged</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">01</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="left">diff;repeat</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">02</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="left">diff;repeat</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">04</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="left">diff;repeat</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">05</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="left">diff;repeat</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">06</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="left">diff;repeat</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">08</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="left">diff;repeat</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">score</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>score <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">score</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">score</span>,<span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Score"</span>, y <span class="op">=</span> <span class="st">"Count"</span><span class="op">)</span></span></code></pre></div>
<p><img src="basic-usage_files/figure-html/unnamed-chunk-23-1.png" width="672" style="display: block; margin: auto;"></p>
<p>These results indicate that there is just one location for which any
flag has been raised. Again, in this case only two components are used
for scoring so the results should be interpreted accordingly.
Furthermore, we have to consider that for reported signals the date at
which the observed data is retrieved is paramount. It will likely be
most meaningful to analyze plausibility of observed data in real time
(or near real time) as opposed to retrospectively, since backfill and
reporting issues may be corrected prior to assessment.</p>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by VP Nagraj, Desiree Williams, Amy Benefield.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
